/*
SpiceUI 2018.10.001

Copyright (c) 2016-present, aac services.k.s - All rights reserved.
Redistribution and use in source and binary forms, without modification, are permitted provided that the following conditions are met:
- Redistributions of source code must retain this copyright and license notice, this list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
- If used the SpiceCRM Logo needs to be displayed in the upper left corner of the screen in a minimum dimension of 31x31 pixels and be clearly visible, the icon needs to provide a link to http://www.spicecrm.io
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*/

/*(c) aac services 2019. All Rights reserved)*/
"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++)for(var o in t=arguments[s])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__decorate=this&&this.__decorate||function(e,t,s,i){var o,a=arguments.length,r=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;0<=n;n--)(o=e[n])&&(r=(a<3?o(r):3<a?o(t,s,r):o(t,s))||r);return 3<a&&r&&Object.defineProperty(t,s,r),r},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),platform_browser_1=require("@angular/platform-browser"),router_1=require("@angular/router"),rxjs_1=require("rxjs"),http_1=require("@angular/common/http"),VersionManagerService=function(){function e(){this._module_versions=[]}return Object.defineProperty(e.prototype,"module_versions",{get:function(){return this._module_versions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"module_version",{set:function(e){var t=this.getModule(e.name);t&&0!=t.length?t=e:this._module_versions.push(e)},enumerable:!0,configurable:!0}),e.prototype.registerModule=function(e){this.module_version={name:e.constructor.name,version:e.version,build_date:e.build_date}},e.prototype.getModule=function(t){return this._module_versions.filter(function(e){return e.name==t})[0]},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[])],e)}();exports.VersionManagerService=VersionManagerService;var MathExpressionCompilerService=function(){function e(){}var t;return(t=e).prototype.do=function(e){return t.evaluate(t.parse(t.lex(e)))},e.lex=function(e){for(var t=function(e){return/[+\-*\/\^%=(),]/.test(e)},s=function(e){return/[0-9]/.test(e)},i=function(e){return/\s/.test(e)},o=function(e){return"string"==typeof e&&!t(e)&&!s(e)&&!i(e)},a=[],r=0,n=function(){return e[++r]},l=function(e,t){a.push({type:e,value:t})};r<e.length;){var u=e[r];if(i(u))n();else if(t(u))l(u),n();else if(s(u)){for(var d="";d+=u,u=n(),s(u););if("."===u)for(;d+=u,u=n(),s(u););var c=parseFloat(d);if(!isFinite(c))throw"Number is too large or too small for a 64-bit double.";l("number",c)}else{if(!o(u))throw"Unrecognized token: "+u+" at "+r;for(var h=u;o(n());)h+=u;l("identifier",h)}}return l("(end)"),a},e.parse=function(s){var a={},o=function(e,t,s,i){var o=a[e]||{};a[e]={lbp:o.lbp||s,nud:o.nud||t,led:o.led||i}};o("(",function(){var e=l(2);if(")"!==r().type)throw"Expected closing parenthesis ')'";return n(),e}),o("number",function(e){return e}),o("identifier",function(e){if("("!==r().type)return e;var t=[];if(")"===s[i+1].type)n();else{for(;n(),t.push(l(2)),","===r().type;);if(")"!==r().type)throw"Expected closing parenthesis ')'"}return n(),{type:"call",args:t,name:e.value}}),o(","),o(")"),o("(end)");var e,t,i=0,r=function(){return e=s[i],(t=Object.create(a[e.type])).type=e.type,t.value=e.value,t;var e,t},n=function(){return i++,r()},l=function(e){var t,s=r();if(n(),!s.nud)throw"Unexpected token: "+s.type;for(t=s.nud(s);e<r().lbp;){if(s=r(),n(),!s.led)throw"Unexpected token: "+s.type;t=s.led(t)}return t},u=function(t,e,s,i){s=s||e,o(t,null,e,i||function(e){return{type:t,left:e,right:l(s)}})};t=7,o(e="-",function(){return{type:e,right:l(t)}}),u("^",6,5),u("*",4),u("/",4),u("%",4),u("+",3),u("-",3),u("=",1,2,function(e){if("call"===e.type){for(var t=0;t<e.args.length;t++)if("identifier"!==e.args[t].type)throw"Invalid argument name";return{type:"function",name:e.name,args:e.args,value:l(2)}}if("identifier"===e.type)return{type:"assign",name:e.value,value:l(2)};throw"Invalid lvalue"});for(var d=[];"(end)"!==r().type;)d.push(l(0));return d},e.evaluate=function(e){for(var i={"+":function(e,t){return e+t},"-":function(e,t){return e-t},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"%":function(e,t){return e%t},"^":function(e,t){return Math.pow(e,t)}},o={pi:Math.PI,e:Math.E},a={sin:Math.sin,cos:Math.cos,tan:Math.cos,asin:Math.asin,acos:Math.acos,atan:Math.atan,abs:Math.abs,round:Math.round,ceil:Math.ceil,floor:Math.floor,log:Math.log,exp:Math.exp,sqrt:Math.sqrt,max:Math.max,min:Math.min,random:Math.random},r={},n=function(s){if("number"===s.type)return s.value;if(i[s.type])return s.left?i[s.type](n(s.left),n(s.right)):i[s.type](n(s.right));if("identifier"===s.type){var e=r.hasOwnProperty(s.value)?r[s.value]:o[s.value];if(void 0===e)throw s.value+" is undefined";return e}if("assign"===s.type)o[s.name]=n(s.value);else{if("call"===s.type){for(var t=0;t<s.args.length;t++)s.args[t]=n(s.args[t]);return a[s.name].apply(null,s.args)}"function"===s.type&&(a[s.name]=function(){for(var e=0;e<s.args.length;e++)r[s.args[e].value]=arguments[e];var t=n(s.value);return r={},t})}},t="",s=0;s<e.length;s++){var l=n(e[s]);void 0!==l&&(t+=l+"\n")}return t},e=t=__decorate([core_1.Injectable()],e)}();exports.MathExpressionCompilerService=MathExpressionCompilerService;var cookie=function(){function e(){}return e.prototype.getValue=function(e){for(var t=e+"=",s=decodeURIComponent(document.cookie).split(";"),i=0;i<s.length;i++){for(var o=s[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""},e.prototype.setValue=function(e,t,s){void 0===s&&(s=365);var i=new Date;i.setTime(i.getTime()+24*s*60*60*1e3);var o="expires="+i.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[])],e)}();exports.cookie=cookie;var session=function(){function e(){this.authData={sessionId:null,loaded:!1,userId:null,userName:"",first_name:"",last_name:"",display_name:"",email:"",password:"",admin:!1,dev:!1,renewPass:!1,portalOnly:!1,googleToken:"",userimage:""},this.footercontainer=null,this.authDataObs=new rxjs_1.Subject,this.authDataObs$=this.authDataObs.asObservable()}return e.prototype.getSessionHeader=function(){var e=new http_1.HttpHeaders;return e=e.set("OAuth-Token",this.authData.sessionId)},e.prototype.setSessionData=function(e,t){sessionStorage.setItem(window.btoa(e+this.authData.sessionId),window.btoa(encodeURIComponent(JSON.stringify(t))))},e.prototype.getSessionData=function(e,t){void 0===t&&(t=!0);try{return JSON.parse(decodeURIComponent(window.atob(sessionStorage.getItem(window.btoa(e+this.authData.sessionId)))))}catch(e){return!!t&&{}}},e.prototype.existsData=function(e){try{return sessionStorage[window.btoa(e+this.authData.sessionId)]&&0<sessionStorage[window.btoa(e+this.authData.sessionId)].length}catch(e){return!1}},e.prototype.endSession=function(){this.authData.sessionId=null,this.authData.userId=null,this.authData.loaded=!1,this.authData.userName="",this.authData.first_name="",this.authData.last_name="",this.authData.display_name="",this.authData.email="",this.authData.userimage="",this.authData.password="",this.authData.admin=!1,this.authData.dev=!1,sessionStorage.clear()},Object.defineProperty(e.prototype,"isAdmin",{get:function(){return this.authData.admin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDev",{get:function(){return this.authData.dev},enumerable:!0,configurable:!0}),e=__decorate([core_1.Injectable()],e)}();exports.session=session;var footer=function(){function e(){this.footercontainer=null,this.modalcontainer=null,this.modalbackdrop=null}return e=__decorate([core_1.Injectable()],e)}();exports.footer=footer;var configurationService=function(){function e(e,t,s,i){var r=this;this.http=e,this.cookie=t,this.session=s,this.router=i,this.initialized=!1,this.sites=[],this.data={backendUrl:"proxy",backendextensions:{},systemparameters:{}},this.loaded$=new core_1.EventEmitter;var o=localStorage.spiceuisites;if(o){this.sites=JSON.parse(atob(o));var a=this.cookie.getValue("spiceuibackend"),n=!1;this.sites.some(function(e){if(e.id==a)return r.setSiteID(e.id),n=!0}),n||this.setSiteID(this.sites[0].id)}e.get("config/sites/").subscribe(function(e){var t=e,s=t.sites;for(var i in 0==s.length&&r.router.navigate(["/setup"]),t.general)r.data[i]=t.general[i];if(0<s.length&&(r.sites=s,localStorage.spiceuisites=btoa(JSON.stringify(s)),!r.data.id)){var o=r.cookie.getValue("spiceuibackend"),a=!1;r.sites.some(function(e){if(e.id==o)return r.setSiteID(e.id),a=!0}),a||r.setSiteID(s[0].id)}r.initialized=!0})}return e.prototype.setSiteData=function(e){for(var t in this.sites.push(e),e)this.data[t]=e[t];localStorage.spiceuisites=btoa(JSON.stringify(this.sites)),this.getSysinfo()},e.prototype.setSiteID=function(s){var i=this;return this.sites.some(function(e){if(e.id==s){for(var t in e)i.data[t]=e[t];return i.cookie.setValue("spiceuibackend",s),!0}}),this.getSysinfo(),this.data},e.prototype.getSiteId=function(){return this.data.id},e.prototype.getBackendUrl=function(){return this.data.backendUrl},e.prototype.getFrontendUrl=function(){return void 0!==this.data.frontendUrl?this.data.frontendUrl:""},e.prototype.getUser=function(){return this.data.user},e.prototype.getPassword=function(){return this.data.password},e.prototype.getSysinfo=function(){var t=this,e=this.http.get(this.getBackendUrl()+"/sysinfo");return e.subscribe(function(e){e&&(t.data.languages=e.languages,t.data.backendextensions=e.extensions,t.data.systemparameters=e.systemsettings,t.loaded$.emit(!0))},function(e){}),e},e.prototype.getSystemParamater=function(e){try{return this.data.systemparameters[e]}catch(e){return!1}},e.prototype.checkCapability=function(e){return this.data.backendextensions&&this.data.backendextensions.hasOwnProperty(e)},e.prototype.getCapabilityConfig=function(e){try{return this.data.backendextensions[e]&&this.data.backendextensions[e].config?this.data.backendextensions[e].config:{}}catch(e){return{}}},e.prototype.setData=function(e,t){this.data[e]=t},e.prototype.getData=function(e){return!!this.data[e]&&this.data[e]},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.HttpClient,cookie,session,router_1.Router])],e)}();exports.configurationService=configurationService;var broadcast=function(){function e(){this.message$=new core_1.EventEmitter}return e.prototype.broadcastMessage=function(e,t){void 0===t&&(t={}),this.message$.emit({messagetype:e,messagedata:t})},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[])],e)}();exports.broadcast=broadcast;var layout=function(){function e(){this.headerheight=90}return Object.defineProperty(e.prototype,"screenwidth",{get:function(){var e=window.innerWidth;return 1024<=e?"large":768<=e?"medium":"small"},enumerable:!0,configurable:!0}),e=__decorate([core_1.Injectable()],e)}();exports.layout=layout;var metadata=function(){function e(e,t,s,i,o,a,r,n,l){var u=this;this.NgModuleFactoryLoader=e,this.http=t,this.session=s,this.configurationService=i,this.componentFactoryResolver=o,this.router=a,this.broadcast=r,this.compiler=n,this.Injector=l,this.moduleDefs={},this.moduleFilters={},this.moduleDirectory={},this.validationRules={},this.htmlStyleData={},this.componentDirectory={},this.componentFactories={},this.componentSets={},this.componentDefaultConfigs={},this.componentModuleConfigs={},this.routes={},this.fieldSets={},this.actionSets={},this.fieldDefs={},this.fieldTypeMappings={},this.fieldStatusNetworks={},this.roles=[],this.rolemodules={},this.role="",this.copyrules={},this.scripts=[],this.moduleLoadHandler=new rxjs_1.Subject,this.broadcast.message$.subscribe(function(e){return u.handleMessage(e)})}return e.prototype.handleMessage=function(e){switch(e.messagetype){case"metadata.updatefieldsets":for(var t in e.messagedata.add)this.fieldSets[t]=e.messagedata.add[t];for(var t in e.messagedata.update)this.fieldSets[t]=e.messagedata.update[t];for(var t in e.messagedata.delete)delete this.fieldSets[t];break;case"metadata.updatecomponentsets":for(var s in e.messagedata.add)this.componentSets[s]=e.messagedata.add[s];for(var s in e.messagedata.update)this.componentSets[s]=e.messagedata.update[s];for(var s in e.messagedata.delete)delete this.componentSets[s]}},e.prototype.loadComponents=function(s,e){var i=this;if(void 0===e&&(e=!1),sessionStorage[window.btoa("metadataComponents"+this.session.authData.sessionId)]&&0<sessionStorage[window.btoa("metadataComponents"+this.session.authData.sessionId)].length&&!e&&!this.configurationService.data.developerMode){var t=this.session.getSessionData("metadataComponents");this.moduleDirectory=t.modules,this.componentDirectory=t.components,this.componentSets=t.componentsets,this.actionSets=t.actionsets,this.componentDefaultConfigs=t.componentdefaultconfigs,this.componentModuleConfigs=t.componentmoduleconfigs,this.routes=t.routes,this.scripts=t.scripts,this.addRoutes(),s.next("loadComponents")}else this.http.get(this.configurationService.getBackendUrl()+"/spiceui/core/components",{headers:this.session.getSessionHeader()}).subscribe(function(e){var t=e;i.moduleDirectory=t.modules,i.componentDirectory=t.components,i.componentSets=t.componentsets,i.routes=t.routes,i.actionSets=t.actionsets,i.componentDefaultConfigs=t.componentdefaultconfigs,i.componentModuleConfigs=t.componentmoduleconfigs,i.scripts=t.scripts,i.session.setSessionData("metadataComponents",{modules:t.modules,components:t.components,componentsets:t.componentsets,actionsets:t.actionsets,componentdefaultconfigs:t.componentdefaultconfigs,componentmoduleconfigs:t.componentmoduleconfigs,routes:t.routes,scripts:t.scripts}),i.addRoutes(),s.next("loadComponents")})},e.prototype.loadModules=function(){var s=this,i=new rxjs_1.Subject;return this.moduleDirectory.some(function(e){return s.loadModule(e),!0}),this.moduleLoadHandler.subscribe(function(e){var t=!1;s.moduleDirectory.some(function(e){if(!s.componentFactories[e.id])return t=!0,s.loadModule(e),!0}),t||(i.next(!0),i.complete())}),i.asObservable()},e.prototype.loadModule=function(o){var a=this;System.import(o.path).then(function(e){return e[o.module]}).then(function(e){a.componentFactories[o.id]={},a.compiler.compileModuleAndAllComponentsAsync(e).then(function(e){for(var t=0,s=e.componentFactories;t<s.length;t++){var i=s[t];a.componentFactories[o.id][i.componentType.name]=i}a.moduleLoadHandler.next()})})},e.prototype.loadFieldSets=function(t,e){var s=this;void 0===e&&(e=!1),!this.session.existsData("metadataFieldSets")||e||this.configurationService.data.developerMode?this.http.get(this.configurationService.getBackendUrl()+"/spiceui/core/fieldsets",{headers:this.session.getSessionHeader()}).subscribe(function(e){s.fieldSets=e,s.session.setSessionData("metadataFieldSets",s.fieldSets),t.next("loadFieldSets")}):(this.fieldSets=this.session.getSessionData("metadataFieldSets"),t.next("loadFieldSets"))},e.prototype.loadFieldDefs=function(s,e){var i=this;void 0===e&&(e=!1);var t=[];for(var o in this.moduleDefs)t.push(o);if(!this.session.existsData("metadataFieldDefs")||e||this.configurationService.data.developerMode)this.http.get(this.configurationService.getBackendUrl()+"/spiceui/core/fielddefs",{headers:this.session.getSessionHeader(),params:{modules:JSON.stringify(t)}}).subscribe(function(e){var t=e;i.session.setSessionData("metadataFieldDefs",t),i.fieldDefs=t.fielddefs,i.fieldTypeMappings=t.fieldtypemappings,i.fieldStatusNetworks=t.fieldstatusnetworks,s.next("loadFieldDefs")});else{var a=this.session.getSessionData("metadataFieldDefs");this.fieldDefs=a.fielddefs,this.fieldTypeMappings=a.fieldtypemappings,this.fieldStatusNetworks=a.fieldstatusnetworks,s.next("loadFieldDefs")}},e.prototype.loadRoutes=function(s){var i=this;this.http.get(this.configurationService.getBackendUrl()+"/spiceui/core/routes",{headers:this.session.getSessionHeader()}).subscribe(function(e){var t=e;i.router.resetConfig(t),s.next("loadRoutes")})},e.prototype.loadModuleDefinitions=function(s,e){var i=this;if(void 0===e&&(e=!1),!this.session.existsData("metadataModuleDefinitions")||e||this.configurationService.data.developerMode)this.http.get(this.configurationService.getBackendUrl()+"/spiceui/core/modules",{headers:this.session.getSessionHeader()}).subscribe(function(e){var t=e;i.session.setSessionData("metadataModuleDefinitions",t),i.moduleDefs=t.modules,i.moduleFilters=t.modulefilters,i.roles=t.roles,i.role="",i.roles.some(function(e){if(1==e.defaultrole)return i.role=e.id,!0}),""===i.role&&0<i.roles.length&&(i.role=i.roles[0].id),i.rolemodules=t.rolemodules,i.copyrules=t.copyrules,s.next("loadModuleDefinitions")});else{var t=this.session.getSessionData("metadataModuleDefinitions");this.moduleDefs=t.modules,this.moduleFilters=t.modulefilters,this.roles=t.roles,this.roles.some(function(e){if(1==e.defaultrole)return i.role=e.id,!0}),""===this.role&&0<this.roles.length&&(this.role=this.roles[0].id),this.rolemodules=t.rolemodules,this.copyrules=t.copyrules,s.next("loadModuleDefinitions")}},e.prototype.loadValidationRules=function(s,e){var i=this;void 0===e&&(e=!1),!this.session.existsData("metadataValidationRules")||e||this.configurationService.data.developerMode?this.http.get(this.configurationService.getBackendUrl()+"/spiceui/core/modelvalidations",{headers:this.session.getSessionHeader()}).subscribe(function(e){var t=e;i.session.setSessionData("metadataValidationRules",t),i.validationRules=t,s.next("loadValidationRules")}):(this.validationRules=this.session.getSessionData("metadataValidationRules"),s.next("loadValidationRules"))},e.prototype.loadHtmlStyling=function(s,e){var i=this;void 0===e&&(e=!1),!this.session.existsData("metadataHtmlStyleData")||e||this.configurationService.data.developerMode?this.http.get(this.configurationService.getBackendUrl()+"/spiceui/core/htmlstyling",{headers:this.session.getSessionHeader()}).subscribe(function(e){var t=e;i.session.setSessionData("metadataHtmlStyleData",t),i.htmlStyleData=t,s.next("loadHtmlStyling")}):(this.htmlStyleData=this.session.getSessionData("metadataHtmlStyleData"),s.next("loadHtmlStyling"))},e.prototype.addRoute=function(t,s){var i=this,o=this.componentDirectory[s].module;System.import(this.moduleDirectory[o].path).then(function(e){return e[i.moduleDirectory[o].module]}).then(function(e){i.moduleDirectory[o].factories={},i.compiler.compileModuleAndAllComponentsAsync(e).then(function(e){e.componentFactories.some(function(e){if(e.componentType.name===s)return i.router.config.push({path:t,component:e.componentType}),!0})})})},e.prototype.addRoutes=function(){var o=this;System.import("app/systemcomponents/systemcomponents").then(function(e){return e.SystemComponents}).then(function(e){o.compiler.compileModuleAndAllComponentsAsync(e).then(function(e){e.componentFactories.some(function(e){if("SystemDynamicRouteContainer"===e.componentType.name){for(var t=0,s=o.routes;t<s.length;t++){var i=s[t];o.router.config.unshift({path:i.path,component:e.componentType})}return!0}})})})},e.prototype.addComponentDirect=function(s,i,o){var a=this,r=new rxjs_1.Subject;if(this.componentDirectory[s])if(this.componentDirectory[s].module){var t=this.componentDirectory[s].module;try{System.import(this.moduleDirectory[t].path).then(function(e){return e[a.moduleDirectory[t].module]}).then(function(e){a.moduleDirectory[t].factories={},a.compiler.compileModuleAndAllComponentsAsync(e).then(function(e){e.componentFactories.some(function(e){if(e.componentType.name===s){var t=i.createComponent(e,void 0,o);return t.instance.self=t,r.next(t),r.complete(),!0}})||(r.error("Cannot find a factory for component "+s),r.complete())})})}catch(e){r.error(e),r.complete()}}else System.import(this.componentDirectory[s].path).then(function(e){return e[s]}).then(function(e){var t=a.componentFactoryResolver.resolveComponentFactory(e),s=i.createComponent(t,void 0,o);s.instance.self=s,r.next(s),r.complete()});else System.import("app/systemcomponents/systemcomponents").then(function(e){return e.SystemComponents}).then(function(e){a.compiler.compileModuleAndAllComponentsAsync(e).then(function(e){e.componentFactories.some(function(e){if("SystemComponentMissing"===e.componentType.name){var t=i.createComponent(e,void 0,o);return t.instance.component=s,r.next(t),r.complete(),!0}})})});return r.asObservable()},e.prototype.checkComponent=function(e){return!!this.componentDirectory[e]},e.prototype.addComponent=function(a,r,n){var l=this,u=new rxjs_1.Subject;return this.componentDirectory[a]?SystemJS.import("app/systemcomponents/systemcomponents").then(function(e){return e.SystemComponents}).then(function(e){l.compiler.compileModuleAndAllComponentsAsync(e).then(function(e){var i=e.componentFactories.find(function(e){return"SystemComponentContainer"===e.componentType.name}),o=r.createComponent(i,void 0,n);return o.instance.containerComponent=a,o.instance.containerRef.subscribe(function(s){if(l.componentDirectory[a].module){var t=l.componentDirectory[a].module;SystemJS.import(l.moduleDirectory[t].path).then(function(e){return e[l.moduleDirectory[t].module]}).then(function(e){l.moduleDirectory[t].factories={},l.compiler.compileModuleAndAllComponentsAsync(e).then(function(e){if(!(i=e.componentFactories.find(function(e){return e.componentType.name===a})))return console.error("Cannot find a factory for component "+a),!1;var t=s.createComponent(i);return t.instance.self=o,u.next(t),u.complete(),o.instance.loaded=!0})})}else System.import(l.componentDirectory[a].path).then(function(e){return e[a]}).then(function(e){var t=l.componentFactoryResolver.resolveComponentFactory(e),s=r.createComponent(t,void 0,n);s.instance.self=s,u.next(s),u.complete()})}),!0})}):SystemJS.import("app/systemcomponents/systemcomponents").then(function(e){return e.SystemComponents}).then(function(e){l.compiler.compileModuleAndAllComponentsAsync(e).then(function(e){e.componentFactories.some(function(e){if("SystemComponentMissing"===e.componentType.name){var t=r.createComponent(e,void 0,n);return t.instance.component=a,u.next(t),u.complete(),!0}})})}),u.asObservable()},e.prototype.getComponentSet=function(e){return this.componentSets[e]},e.prototype.getAllComponentsets=function(){try{return this.componentSets}catch(e){return""}},e.prototype.addComponentSet=function(e,t,s,i){void 0===i&&(i="custom"),this.componentSets[e]={name:s,module:t,type:i,items:[]}},e.prototype.getRawComponentSets=function(){return this.componentSets},e.prototype.getComponentSets=function(e){void 0===e&&(e="");var t=[];for(var s in this.componentSets)""!==e&&this.componentSets[s].module!==e||t.push({id:s,name:this.componentSets[s].name,module:this.componentSets[s].module,type:this.componentSets[s].type});return t.sort(function(e,t){return e.name>t.name?1:-1}),t},e.prototype.getComponentSetObjects=function(e){try{return this.componentSets[e].items}catch(e){return[]}},e.prototype.addComponentToComponentset=function(e,t,s){this.componentSets[t].items.push({id:e,component:s,componentconfig:{},sequence:0});for(var i=0,o=0,a=this.componentSets[t].items;o<a.length;o++){a[o].sequence=i,i++}},e.prototype.getRawFieldSets=function(){return this.fieldSets},e.prototype.getFieldSets=function(e,t){void 0===e&&(e=""),void 0===t&&(t="");var s=[];for(var i in this.fieldSets)""!==e&&this.fieldSets[i].module!==e||s.push({id:i,name:this.fieldSets[i].name,module:this.fieldSets[i].module,type:this.fieldSets[i].type});return s.sort(function(e,t){return e.name>t.name?1:-1}),s},e.prototype.getFieldset=function(e){try{return this.fieldSets[e]}catch(e){return""}},e.prototype.getAllFieldsets=function(){try{return this.fieldSets}catch(e){return""}},e.prototype.setFieldset=function(e,t){this.fieldSets[e].name=t.name,this.fieldSets[e].package=t.package},e.prototype.addFieldset=function(e,t,s,i,o){void 0===i&&(i="custom"),void 0===o&&(o=[]),this.fieldSets[e]={items:o,module:t,name:s,type:i}},e.prototype.addFieldsetToFieldset=function(e,t,s){this.fieldSets[t].items.push({id:e,fieldset:s,fieldconfig:{},sequence:0});for(var i=0,o=0,a=this.fieldSets[t].items;o<a.length;o++){a[o].sequence=i,i++}},e.prototype.addFieldToFieldset=function(e,t,s){this.fieldSets[t].items.push({id:e,field:s,fieldconfig:{},sequence:0});for(var i=0,o=0,a=this.fieldSets[t].items;o<a.length;o++){a[o].sequence=i,i++}},e.prototype.removeFieldsetItem=function(e,s){var i=!1;if(this.fieldSets[e].items.some(function(e,t){if(e.id==s.id)return i=t,!0}),!1===i)return!1;this.fieldSets[e].items.splice(i,1);for(var t=0,o=0,a=this.fieldSets[e].items;o<a.length;o++){a[o].sequence=t,t++}return!0},e.prototype.getFieldsetName=function(e){try{return this.fieldSets[e].name}catch(e){return""}},e.prototype.getFieldSetFields=function(e){return this.fieldSets[e]?this.fieldSets[e].items:[]},e.prototype.getFieldSetItems=function(e){return this.fieldSets[e]?this.fieldSets[e].items:[]},e.prototype.getFieldlabel=function(e,t){try{return this.fieldDefs[e][t].vname}catch(e){return t}},e.prototype.getAppModules=function(){var e=[];for(var t in this.moduleDirectory)this.moduleDirectory.hasOwnProperty(t)&&e.push(this.moduleDirectory[t]);return e},e.prototype.getModuleDefs=function(e){return this.moduleDefs[e]},e.prototype.getModuleDuplicatecheck=function(e){try{return"1"===this.moduleDefs[e].duplicatecheck}catch(e){return!1}},e.prototype.getModules=function(){var e=[];for(var t in this.moduleDefs)e.push(t);return e},e.prototype.getModuleIcon=function(e){try{return this.moduleDefs[e].icon}catch(e){return!1}},e.prototype.getModuleSingular=function(t){try{return this.moduleDefs[t].singular}catch(e){return t}},e.prototype.getModuleFromSingular=function(e){var t="";for(var s in this.moduleDefs)this.moduleDefs[s].singular==e&&(t=s);return t},e.prototype.getModuleTrackflag=function(e){try{return!!parseInt(this.moduleDefs[e].track,10)}catch(e){return!1}},e.prototype.getModuleFields=function(e){try{return this.fieldDefs[e]?this.fieldDefs[e]:[]}catch(e){return[]}},e.prototype.getModuleValidations=function(e){try{return this.validationRules[e].validations}catch(e){return[]}},e.prototype.getModuleMenu=function(e){try{var t=[];return this.moduleDefs[e].actionset&&(t=this.getActionSetItems(this.moduleDefs[e].actionset)),t}catch(e){return[]}},e.prototype.getModuleListTypes=function(e){try{return this.moduleDefs[e].listtypes}catch(e){return[]}},e.prototype.addModuleListType=function(e,t){this.moduleDefs[e].listtypes.push(t)},e.prototype.updateModuleListType=function(e,s){this.moduleDefs[e].listtypes.some(function(e){if(e.id==s.id){for(var t in s)s.hasOwnProperty(t)&&(e[t]=s[t]);return!0}})},e.prototype.getFieldDefs=function(e,t){try{return this.fieldDefs[e][t]}catch(e){return"varchar"}},e.prototype.checkStatusManaged=function(e){for(var t in this.fieldDefs[e])if(this.getFieldDefs(e,t).options&&this.fieldStatusNetworks[this.getFieldDefs(e,t).options])return{statusField:this.getFieldDefs(e,t).name,statusNetwork:this.fieldStatusNetworks[this.getFieldDefs(e,t).options]};return!1},e.prototype.getFieldType=function(e,t){try{return this.fieldDefs[e][t].type}catch(e){return"varchar"}},e.prototype.getFieldOptions=function(e,t){try{return this.fieldDefs[e][t].options}catch(e){return!1}},e.prototype.getFieldRequired=function(e,t){try{return this.fieldDefs[e][t].required}catch(e){return!1}},e.prototype.getSystemModules=function(){var e=[];for(var t in this.moduleDirectory)e.push(this.moduleDirectory[t]);return e.sort(function(e,t){return e.module>t.module?1:-1}),e},e.prototype.getSystemComponents=function(e){void 0===e&&(e=void 0);var t=[];for(var s in this.componentDirectory)e&&e!=this.componentDirectory[s].module||t.push(this.componentDirectory[s]);return t.sort(function(e,t){return e.component>t.component?1:-1}),t},e.prototype.getComponentConfigOptions=function(e){try{return this.componentDirectory[e].componentconfig}catch(e){return{}}},e.prototype.getComponentConfigurations=function(e){return void 0===e&&(e="*"),"*"===e?this.componentDefaultConfigs:this.componentModuleConfigs[e]?this.componentModuleConfigs[e]:{}},e.prototype.getComponentConfig=function(e,t,s){return void 0===e&&(e=""),void 0===t&&(t=""),void 0===s&&(s=""),""===s&&(s=this.role?this.role:"*"),""!=t&&this.componentModuleConfigs[t]&&this.componentModuleConfigs[t][e]&&this.componentModuleConfigs[t][e][s]?this.componentModuleConfigs[t][e][s]:""!=t&&this.componentModuleConfigs[t]&&this.componentModuleConfigs[t][e]&&this.componentModuleConfigs[t][e]["*"]?this.componentModuleConfigs[t][e]["*"]:this.componentDefaultConfigs[e]&&this.componentDefaultConfigs[e][s]?this.componentDefaultConfigs[e][s]:this.componentDefaultConfigs[e]&&this.componentDefaultConfigs[e]["*"]?this.componentDefaultConfigs[e]["*"]:{}},e.prototype.getModuleDefaultComponentConfigByUsage=function(e,t){var s="";switch(t){case"list":s="ObjectList";break;case"details":s="ObjectRecordDetails"}return this.getComponentConfig(s,e)},e.prototype.getActionSets=function(e){void 0===e&&(e="");var t=[];for(var s in this.actionSets)""!==e&&this.actionSets[s].module!==e&&"*"!==this.actionSets[s].module||t.push({id:s,name:this.actionSets[s].name,module:this.actionSets[s].module,type:this.actionSets[s].type});return t.sort(function(e,t){return e.name>t.name?1:-1}),t},e.prototype.getActionSet=function(e){return this.actionSets[e]},e.prototype.getActionSetItems=function(e){try{return this.actionSets[e].actions}catch(e){return[]}},e.prototype.getModuleFilters=function(e){void 0===e&&(e="");var t=[];for(var s in this.moduleFilters)if(this.moduleFilters.hasOwnProperty(s)){if(""!==e&&this.moduleFilters[s].module!==e)continue;t.push(this.moduleFilters[s])}return t.sort(function(e,t){return e.name-t.name}),t},e.prototype.getModuleFilter=function(e){try{return this.moduleFilters[e]}catch(e){return""}},e.prototype.setModuleFilter=function(e,t,s,i){void 0===i&&(i="custom"),this.moduleFilters||(this.moduleFilters={}),this.moduleFilters[e]={id:e,name:t,module:s,type:i}},e.prototype.removeModuleFilter=function(e){delete this.moduleFilters[e]},e.prototype.checkModuleAcl=function(e,t){try{return this.moduleDefs[e].acl[t]}catch(e){return!1}},e.prototype.getRoles=function(){return this.roles},e.prototype.getActiveRole=function(){var t=this,s={};return this.roles.some(function(e){if(t.role==e.id)return s=e,!0}),s},e.prototype.setActiveRole=function(e){this.role=e},e.prototype.getRoleModules=function(e){void 0===e&&(e=!1);var t=[];if(this.rolemodules[this.role])for(var s=0,i=this.rolemodules[this.role];s<i.length;s++){var o=i[s];(!1===e||null!==o.sequence)&&this.moduleDefs[o.module]&&this.moduleDefs[o.module].visible&&this.moduleDefs[o.module].acl.list&&t.push(o.module)}return t},e.prototype.getCopyRules=function(e,t){return this.copyrules[e]&&this.copyrules[e][t]?this.copyrules[e][t]:[]},e.prototype.getFieldTypes=function(){var e=[];for(var t in this.fieldTypeMappings)e.push(t);return e},e.prototype.getFieldTypeComponent=function(e){return this.fieldTypeMappings[e]},e.prototype.getRouteComponent=function(a){var r="";return this.routes.some(function(e){if(e.path==a)return r=e.component,!0;if(a.split("/").length==e.path.split("/").length){for(var t=a.split("/"),s=e.path.split("/"),i=!0,o=0;o<t.length&&i;)":"!==s[o].substr(0,1)&&s[o]!==t[o]&&(i=!1),o++;if(i)return r=e.component,!0}}),r},e.prototype.checkTagging=function(e){try{return!!this.moduleDefs[e].tagging}catch(e){return!1}},e.prototype.loadLibs=function(){for(var t=this,e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];var i=[];e.forEach(function(e){i.push(t.loadLib(e))});for(var o=new rxjs_1.Subject,a=0,r=0,n=i;r<n.length;r++){n[r].subscribe(function(e){a++},function(e){a++,console.error(e),o.error(e)},function(){a==i.length&&(o.next(),o.complete())})}return a==i.length?rxjs_1.of(o):o.asObservable()},e.prototype.loadLib=function(t){var s=this,i=new rxjs_1.Subject;if(!this.scripts[t])return rxjs_1.of({script:t,loaded:!1,status:"Unknown"});if(this.isLibLoaded(t))return rxjs_1.of({script:t,loaded:!0,status:"Already Loaded"});if(this.isLibLoading(t))for(var e=0,o=this.scripts[t];e<o.length;e++){var a=o[e];if(a.loading)return a.loading$.subscribe(function(e){return s.loadLib(t).subscribe(function(e){i.next(e),i.complete()})}),i.asObservable()}else{for(var r=0,n=this.scripts[t];r<n.length;r++){var l=n[r];if(!l.loaded)return this.loadScript(l).subscribe(function(e){s.loadLib(t).subscribe(function(e){i.next(e),i.complete()})}),i.asObservable()}i.next({script:t,loaded:!0,status:"Loaded"}),i.complete()}return i.asObservable()},e.prototype.loadScript=function(t){var s=new rxjs_1.Subject;t.loading=!0,t.loading$=new core_1.EventEmitter;var e={};return t.src.endsWith(".css")?((e=document.createElement("link")).rel="stylesheet",e.href=t.src):((e=document.createElement("script")).type="text/javascript",e.src=t.src),e.readyState?e.onreadystatechange=function(){"loaded"!==e.readyState&&"complete"!==e.readyState||(e.onreadystatechange=null,t.loaded=!0,t.loading=!1,s.next({script:t.src,loaded:!0,status:"Loaded"}),s.complete(),t.loading$.emit("loaded"))}:e.onload=function(){t.loaded=!0,t.loading=!1,s.next({script:t.src,loaded:!0,status:"Loaded"}),s.complete(),t.loading$.emit("loaded")},e.onerror=function(e){t.loading=!1,s.error({script:t.src,loaded:!1,status:"Failed"}),t.loading$.emit("failed")},document.getElementsByTagName("head")[0].appendChild(e),s.asObservable()},e.prototype.isLibLoaded=function(e){if(this.scripts[e]){for(var t=0,s=this.scripts[e];t<s.length;t++){if(!s[t].loaded)return!1}return!0}return!1},e.prototype.isLibLoading=function(e){if(this.scripts[e]){for(var t=0,s=this.scripts[e];t<s.length;t++){if(s[t].loading)return!0}return!1}return!1},e.prototype.getHtmlStylesheetCode=function(e){return _.isObject(this.htmlStyleData.stylesheets[e])&&_.isString(this.htmlStyleData.stylesheets[e].csscode)?this.htmlStyleData.stylesheets[e].csscode:""},e.prototype.getHtmlFormats=function(e){return _.isObject(this.htmlStyleData.stylesheets[e])?(_.isArray(this.htmlStyleData.stylesheets[e].formats)||(this.htmlStyleData.stylesheets[e].formats=[]),this.htmlStyleData.stylesheets[e].stylesDecoded||this.htmlStylesToObjects(e),this.htmlStyleData.stylesheets[e].formats):(console.log("HTML Styling: Unknown style sheet with ID "+e+"."),[])},e.prototype.htmlStylesToObjects=function(e){for(var t=0,s=this.htmlStyleData.stylesheets[e].formats;t<s.length;t++){var i=s[t],o=void 0;if(_.isEmpty(i.styles))i.styles=null;else{try{o=JSON.parse(i.styles)}catch(e){console.log("HTML Styling: Malformed style specification in table sysuihtmlformats (format id: "+i.id+")."),o={}}i.styles=o}}this.htmlStyleData.stylesheets[e].stylesDecoded=!0},e.prototype.getHtmlStylesheetNames=function(){var e=[];for(var t in this.htmlStyleData.stylesheets)e.push({id:this.htmlStyleData.stylesheets[t].id,name:this.htmlStyleData.stylesheets[t].name});return _.sortBy(e,"name")},e.prototype.getHtmlStylesheetToUse=function(e,t){return _.isObject(this.htmlStyleData.stylesheetsToUse[e])&&this.htmlStyleData.stylesheetsToUse[e][t]?this.htmlStyleData.stylesheetsToUse[e][t]:""},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[core_1.NgModuleFactoryLoader,http_1.HttpClient,session,configurationService,core_1.ComponentFactoryResolver,router_1.Router,broadcast,core_1.Compiler,core_1.Injector])],e)}();exports.metadata=metadata;var aclCheck=function(){function e(e,t,s){this.metadata=e,this.router=t,this.session=s}return e.prototype.canActivate=function(e,t){return!("Users"===e.params.module&&!this.session.authData.admin)&&(!(e.params.module&&"Home"!=e.params.module&&!this.metadata.checkModuleAcl(e.params.module,"list"))||(this.router.navigate(["/modules/Home"]),!1))},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[metadata,router_1.Router,session])],e)}();exports.aclCheck=aclCheck;var language=function(){function e(e,t,s,i,o){this.http=e,this.configurationService=t,this.session=s,this.metadata=i,this.cookie=o,this.languagedata={},this._currentlanguage="",this.currentlanguage$=new core_1.EventEmitter}return Object.defineProperty(e.prototype,"currentlanguage",{get:function(){return this._currentlanguage},set:function(e){this._currentlanguage=e,this.cookie.setValue("spiceuilanguage",e)},enumerable:!0,configurable:!0}),e.prototype.getLanguage=function(e){if(sessionStorage[window.btoa("languageData"+this.session.authData.sessionId)]&&0<sessionStorage[window.btoa("languageData"+this.session.authData.sessionId)].length&&!this.configurationService.data.developerMode){var t=this.session.getSessionData("languageData");this.languagedata=t,""==this.currentlanguage&&(this.currentlanguage=t.languages.default),e.next("getLanguage")}else this.loadLanguage().subscribe(function(){e.next("getLanguage")})},e.prototype.loadLanguage=function(){var s=this,i=new rxjs_1.Subject,e={modules:JSON.stringify(this.metadata.getModules())};return""==this.currentlanguage&&this.cookie.getValue("spiceuilanguage")&&(this.currentlanguage=this.cookie.getValue("spiceuilanguage")),""!=this.currentlanguage&&(e.lang=this.currentlanguage),this.http.post(this.configurationService.getBackendUrl()+"/module/language",{},{headers:this.session.getSessionHeader(),observe:"response",params:e}).subscribe(function(e){var t=e.body;s.session.setSessionData("languageData",t),s.languagedata=t,""==s.currentlanguage&&(s.currentlanguage=t.languages.default),s.currentlanguage$.emit(s.currentlanguage),i.next(!0),i.complete()}),i.asObservable()},e.prototype.getModuleLabel=function(e,t,s){return void 0===s&&(s="default"),this.getLabel(t,e,s)},e.prototype.getLabel=function(t,e,s){void 0===e&&(e=""),void 0===s&&(s="default");try{return""!=e&&void 0!==this.languagedata.mod&&null!=this.languagedata.mod[e]&&this.languagedata.mod[e][t]?this.languagedata.mod[e][t]:this.getAppLanglabel(t,s)}catch(e){return t}},e.prototype.getAppLanglabel=function(e,t){return void 0===t&&(t="default"),this.languagedata.applang[e]?"object"==typeof this.languagedata.applang[e]&&this.languagedata.applang[e][t]?this.getNestedLabel(e,t):this.getNestedLabel(e):e},e.prototype.getNestedLabel=function(e,t){var s;if(void 0===t&&(t="default"),this.languagedata.applang[e]&&(_.isObject(this.languagedata.applang[e])?s=this.languagedata.applang[e][t]?this.languagedata.applang[e][t]:this.languagedata.applang[e].default:_.isString(this.languagedata.applang[e])&&(s=this.languagedata.applang[e])),s){var i=this.getNestedTags(s);if(i)for(var o=0,a=i;o<a.length;o++){var r=a[o];s=s.replace("{LABEL:"+r+"}",this.getNestedLabel(r,t))}}return s||e},e.prototype.getNestedTags=function(e){for(var t=e.indexOf("{LABEL:"),s=[];0<=t;)if(0<=t){var i=e.indexOf("}",t);t=0<=i?(s.push(e.substring(t+7,i)),e.indexOf("{LABEL:",i)):-1}return s},e.prototype.getLabelFormatted=function(e,t,s){var i;void 0===s&&(s=""),i=Array.isArray(t)?t:new Array(t);var o=0;return this.getLabel(e,s).replace(/%(s|%)/g,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"s"===e[1]?i[o++]:"%"===e[1]?"%":e[0]})},e.prototype.getModuleName=function(t,e,s){void 0===e&&(e=!1),void 0===s&&(s="default");try{var i=this.metadata.getModuleDefs(t);if(e){if(i.singular_label)return this.getAppLanglabel(i.singular_label,s);if(this.languagedata.applist.moduleListSingular[t])return this.languagedata.applist.moduleListSingular[t]}else if(i.module_label)return this.getAppLanglabel(i.module_label,s);return this.languagedata.applist.moduleList[t]}catch(e){return t}},e.prototype.getFieldDisplayName=function(e,t,s,i){void 0===s&&(s={}),void 0===i&&(i="default");var o="";if(s.label)if(0<s.label.indexOf(":")){var a=s.label.split(":");o=this.getLabel(a[1],a[0])}else o=this.getLabel(s.label,e,i);else o=this.getModuleLabel(e,this.metadata.getFieldlabel(e,t),i);return""===o?s.label?s.label:t:o},e.prototype.getFieldDisplayOptions=function(e,t,s){void 0===s&&(s=!1);var i=this.metadata.getFieldOptions(e,t);if(!1===i)return[];try{var o=this.languagedata.applist[i];if(s){var a=o;for(var r in o=[],a)o.push({value:r,display:a[r]})}return o}catch(e){return[]}},e.prototype.getDisplayOptions=function(e,t){void 0===t&&(t=!1);var s=this.languagedata.applist[e];if(t){var i=s;for(var o in s=[],i)s.push({value:o,display:i[o]})}return s},e.prototype.getFieldDisplayOptionValue=function(e,t,s){var i=this.metadata.getFieldOptions(e,t);if(!1===i)return s;try{return this.languagedata.applist[i][s]}catch(e){return s}},e.prototype.getAvialableLanguages=function(e){void 0===e&&(e=!1);for(var t=[],s=0,i=this.languagedata.languages.available;s<i.length;s++){var o=i[s];(!e||o.system_language&&0!=o.system_language)&&t.push({language:o.language_code,text:o.language_name,system_language:o.system_language,communication_language:o.communication_language,default_language:o.language_code==this.languagedata.languages.default})}return t},e.prototype.addAvailableLanguage=function(t){var s=this,i=!1;this.languagedata.languages.available.some(function(e){if(e.language_code==t.language_code)return e.system_language=t.system_language,e.default_language=t.default_language,t.default_language&&s.setDefaultLanguage(t.language_code),i=!0}),i||this.languagedata.languages.available.push(t)},e.prototype.removeAvailableLanguage=function(t){this.languagedata.languages.available.some(function(e){if(e.language_code==t)return!(e.system_language=!1)})},e.prototype.getDefaultLanguage=function(){return this.languagedata.languages.default},e.prototype.setDefaultLanguage=function(t){var s=this;this.http.post(this.configurationService.getBackendUrl()+"/syslanguages/setdefault/"+t,{},{headers:this.session.getSessionHeader(),observe:"response"}).subscribe(function(e){e.body.success&&(s.languagedata.languages.default=t)})},e.prototype.getLangText=function(t){var s=t;return this.languagedata.languages.available.some(function(e){if(e.language_code==t)return s=e.language_name,!0}),s},e.prototype.searchLabel=function(e,t){void 0===t&&(t=10);var s=[],i=e.toLowerCase().split(" ");for(var o in this.languagedata.applang){for(var a=!0,r=0,n=i;r<n.length;r++){var l=n[r];if(o.toLocaleLowerCase().indexOf(l)<0){a=!1;break}}if(a&&s.push({label:o,translation:this.getAppLanglabel(o)}),s.length>=t)break}return s},e.prototype.addLabel=function(e,t,s,i){void 0===t&&(t=""),void 0===s&&(s=""),void 0===i&&(i=""),this.languagedata.applang[e]={default:t,long:i,short:s}},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.HttpClient,configurationService,session,metadata,cookie])],e)}();exports.language=language,moment.defaultFormat="YYYY-MM-DD HH:mm:ss";var modelutilities=function(){function e(e,t){this.metadata=e,this.mathcomp=t,this.formatDate=function(e){return moment(e).format("YYYY-MM-DD")}}var s;return(s=e).prototype.getRand=function(){return Math.random()},e.prototype.S4=function(){return(65536*(1+this.getRand())|0).toString(16).substring(1)},e.prototype.generateGuid=function(){return this.S4()+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()},e.prototype.backendModel2spice=function(e,t){var s=this.metadata.getModuleFields(e);for(var i in s)t[i]&&(t[i]=this.backend2spice(e,i,t[i]));return t},e.prototype.backend2spice=function(e,t,s){var i=this.metadata.getFieldDefs(e,t);if(!i||!i.type)return s;switch(i.type){case"date":var o=moment.utc(s);return o.isValid()?o:null;case"datetime":case"datetimecombo":var a=moment(s).tz(moment.tz.guess());return a.add(a.utcOffset(),"m"),a;case"double":case"currency":return s?parseFloat(s):0;case"int":return s?parseInt(s,10):0;case"bool":case"boolean":return"1"==s||0<s||1==s;case"json":try{return s?JSON.parse(s):{}}catch(e){return{}}case"link":if(_.isObject(s)&&s.beans&&i.module)for(var r in s.beans)s.beans[r]=this.backendModel2spice(i.module,s.beans[r]);return s;default:return s}},e.prototype.spiceModel2backend=function(e,t){var s=__assign({},t),i=this.metadata.getModuleFields(e);for(var o in i)t.hasOwnProperty(o)&&(s[o]=this.spice2backend(e,o,t[o]));return s},e.prototype.spice2backend=function(e,t,s){var i=this.metadata.getFieldDefs(e,t);if(!i||!i.type)return s;switch(i.type){case"date":if(s._isAMomentObject)return s.isValid()?s.format("YYYY-MM-DD"):"";var o=new moment.utc(s);return o.isValid()?o.format("YYYY-MM-DD"):"";case"datetime":case"datetimecombo":if("string"==typeof s&&""===s.trim())return"";if(s._isAMomentObject&&!s.isValid())return"";var a=new moment(s).tz(moment.tz.guess());return a.subtract(a.utcOffset(),"m"),a.format("YYYY-MM-DD HH:mm:ss");case"json":return s?JSON.stringify(s):"";case"link":if(_.isObject(s)&&s.beans&&i.module)for(var r in s.beans)s.beans[r]=this.spiceModel2backend(i.module,s.beans[r]);return s;case"bool":case"boolean":return s&&("1"==s||0<s||!0===s)?"1":"0";default:return s}},e.prototype.cleanAccountName=function(e){for(var t=e.toLowerCase(),s=(t=t.replace(/[^\w\s]/gi,"")).split(" "),i=0,o=["ag","gmbh","gesmbh","corp","inc"];i<o.length;i++){var a=o[i],r=s.indexOf(a);0<=r&&s.splice(r,1)}return s.join(" ")},e.compare=function(e,t,s){switch(t){case"in":case"between":break;case"contain":return-1!==e.indexOf(s);case"greaterequal":return s<=e;case"greater":return s<e;case"lesserequal":return e<=s;case"lesser":return e<s;case"unequal":return e!=s;case"equal":default:return e==s}},e.strtobool=function(e){if("string"!=typeof e)return!1;switch(e.toLowerCase().trim()){case"false":case"no":case"0":case"":return!1;default:return!0}},e.strtomoment=function(e,t){return moment(s.strtotime(e,t),"X")},e.strtotime=function(e,t){var s,i,o,a,d,c,h,r,n,l;if(!e)return!1;e=e.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ").replace(/[\t\r\n]/g,"").toLowerCase();var u=new RegExp(["^(\\d{1,4})","([\\-\\.\\/:])","(\\d{1,2})","([\\-\\.\\/:])","(\\d{1,4})","(?:\\s(\\d{1,2}):(\\d{2})?:?(\\d{2})?)?","(?:\\s([A-Z]+)?)?$"].join(""));if((i=e.match(u))&&i[2]===i[4])if(1901<i[1])switch(i[2]){case"-":return!(12<i[3]||31<i[5])&&new Date(i[1],parseInt(i[3],10)-1,i[5],i[6]||0,i[7]||0,i[8]||0,i[9]||0).getTime()/1e3;case".":return!1;case"/":return!(12<i[3]||31<i[5])&&new Date(i[1],parseInt(i[3],10)-1,i[5],i[6]||0,i[7]||0,i[8]||0,i[9]||0).getTime()/1e3}else if(1901<i[5])switch(i[2]){case"-":case".":return!(12<i[3]||31<i[1])&&new Date(i[5],parseInt(i[3],10)-1,i[1],i[6]||0,i[7]||0,i[8]||0,i[9]||0).getTime()/1e3;case"/":return!(12<i[1]||31<i[3])&&new Date(i[5],parseInt(i[1],10)-1,i[3],i[6]||0,i[7]||0,i[8]||0,i[9]||0).getTime()/1e3}else switch(i[2]){case"-":return!(12<i[3]||31<i[5]||i[1]<70&&38<i[1])&&(a=0<=i[1]&&i[1]<=38?+i[1]+2e3:i[1],new Date(a,parseInt(i[3],10)-1,i[5],i[6]||0,i[7]||0,i[8]||0,i[9]||0).getTime()/1e3);case".":return 70<=i[5]?!(12<i[3]||31<i[1])&&new Date(i[5],parseInt(i[3],10)-1,i[1],i[6]||0,i[7]||0,i[8]||0,i[9]||0).getTime()/1e3:i[5]<60&&!i[6]&&(!(23<i[1]||59<i[3])&&(o=new Date,new Date(o.getFullYear(),o.getMonth(),o.getDate(),i[1]||0,i[3]||0,i[5]||0,i[9]||0).getTime()/1e3));case"/":return!(12<i[1]||31<i[3]||i[5]<70&&38<i[5])&&(a=0<=i[5]&&i[5]<=38?+i[5]+2e3:i[5],new Date(a,parseInt(i[1],10)-1,i[3],i[6]||0,i[7]||0,i[8]||0,i[9]||0).getTime()/1e3);case":":return!(23<i[1]||59<i[3]||59<i[5])&&(o=new Date,new Date(o.getFullYear(),o.getMonth(),o.getDate(),i[1]||0,i[3]||0,i[5]||0).getTime()/1e3)}if("now"===e)return null===t||isNaN(t)?(new Date).getTime()/1e3|0:0|t;if(!isNaN(s=Date.parse(e)))return s/1e3|0;if(u=new RegExp(["^([0-9]{4}-[0-9]{2}-[0-9]{2})","[ t]","([0-9]{2}:[0-9]{2}:[0-9]{2}(\\.[0-9]+)?)","([\\+-][0-9]{2}(:[0-9]{2})?|z)"].join("")),(i=e.match(u))&&("z"===i[4]?i[4]="Z":i[4].match(/^([+-][0-9]{2})$/)&&(i[4]=i[4]+":00"),!isNaN(s=Date.parse(i[1]+"T"+i[2]+i[4]))))return s/1e3|0;function p(e){var t,s,i,o,a=e.split(" "),r=a[0],n=a[1].substring(0,3),l=/\d+/.test(r),u=("last"===r?-1:1)*("ago"===a[2]?-1:1);if(l&&(u*=parseInt(r,10)),h.hasOwnProperty(n)&&!a[1].match(/^mon(day|\.)?$/i))return d["set"+h[n]](d["get"+h[n]]()+u);if("wee"===n)return d.setDate(d.getDate()+7*u);if("next"===r||"last"===r)t=r,s=u,void 0!==(o=c[n])&&(0==(i=o-d.getDay())?i=7*s:0<i&&"last"===t?i-=7:i<0&&"next"===t&&(i+=7),d.setDate(d.getDate()+i));else if(!l)return!1;return!0}if(d=t?new Date(1e3*t):new Date,c={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},h={yea:"FullYear",mon:"Month",day:"Date",hou:"Hours",min:"Minutes",sec:"Seconds"},"([+-]?\\d+\\s"+(n="(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)")+"|(last|next)\\s"+n+")(\\sago)?",!(i=e.match(new RegExp("([+-]?\\d+\\s(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)|(last|next)\\s(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?))(\\sago)?","gi"))))return!1;for(l=0,r=i.length;l<r;l++)if(!p(i[l]))return!1;return d.getTime()/1e3},e.prototype.http_build_query=function(e,t,s){void 0===t&&(t=""),void 0===s&&(s="&");var i=[],a=function(e,t,s){var i=[];if(!0===t?t="1":!1===t&&(t="0"),null===t)return"";if("object"==typeof t){for(var o in t)null!==t[o]&&i.push(a(e+"["+o+"]",t[o],s));return i.join(s)}if("function"!=typeof t)return encodeURIComponent(e)+"="+encodeURIComponent(t);throw new Error("There was an error processing for http_build_query().")};for(var o in s||(s="&"),e){var r=e[o];t&&!isNaN(parseFloat(o))&&(o=String(t)+o);var n=a(o,r,s);""!==n&&i.push(n)}return i.join(s)},e.prototype.compileMathExpression=function(e){try{return this.mathcomp.do(e)}catch(e){return console.warn(e),!1}},e=s=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[metadata,MathExpressionCompilerService])],e)}();exports.modelutilities=modelutilities;var toast=function(){function e(e){this.modelutilities=e,this.activeToasts=[]}return e.prototype.sendToast=function(e,t,s,i){var o=this;void 0===t&&(t="default"),void 0===s&&(s=""),void 0===i&&(i=!0),"error"===t&&(i=!1),!0===i&&(i=5);var a=this.modelutilities.generateGuid();return this.activeToasts.push({id:a,type:t,theme:"toast",text:e,description:s}),i&&window.setTimeout(function(){return o.clearToast(a)},1e3*i),a},e.prototype.sendAlert=function(e,t,s,i){var o=this;void 0===t&&(t="default"),void 0===s&&(s=""),void 0===i&&(i=!0),!0===i&&(i=5);var a=this.modelutilities.generateGuid();return this.activeToasts.push({id:a,type:t,theme:"alert",text:e,description:s}),i&&window.setTimeout(function(){return o.clearToast(a)},1e3*i),a},e.prototype.clearToast=function(s){var i=this;s&&this.activeToasts.some(function(e,t){if(e.id===s)return i.activeToasts.splice(t,1),!0})},e.prototype.clearAll=function(){this.activeToasts=[]},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[modelutilities])],e)}();exports.toast=toast;var modal=function(){function e(e,t,s,i){var o=this;this.metadata=e,this.footer=t,this.toast=s,this.utils=i,this.modalsArray=[],this.modalsObject={},window.addEventListener("keyup",function(e){if(27===e.keyCode&&o.modalsArray.length){var t=o.modalsArray[o.modalsArray.length-1].wrapper;!t.instance.escKey||t.instance.childComponent.instance.onModalEscX&&!1===t.instance.childComponent.instance.onModalEscX()||t.destroy()}})}return e.prototype.openModal=function(i,e,o){var a=this;if(void 0===e&&(e=!0),this.metadata.checkComponent(i)){var r=new rxjs_1.Subject;return this.metadata.addComponentDirect("SystemModalWrapper",this.footer.modalcontainer).subscribe(function(t){var s={};(s.wrapper=t).instance.escKey=e,a.modalsArray.push(s),a.modalsObject[s.modalId]=s,a.metadata.addComponentDirect(i,t.instance.target,o).subscribe(function(e){e.instance.self=t,s.component=e,t.instance.childComponent=e,r.next(e),r.complete()},function(e){a.removeModal(t),a.sendError(i),r.error(e),r.complete()}),t.instance.zIndex=2*a.modalsArray.length+1}),r.asObservable()}return this.sendError(i),rxjs_1.of(!1)},e.prototype.sendError=function(e){this.toast.sendToast('Component "'+e+'" not found.',"error","Misconfiguration on the system as the component should have been opened in a modal but is not avilable. Please contact your system administrator.")},e.prototype.removeModal=function(e){for(var t=0;t<this.modalsArray.length;t++)if(this.modalsArray[t].wrapper===e){this.modalsArray.splice(t,1);break}},e.prototype.closeModal=function(e){if("number"==typeof e)this.modalsArray[e]&&this.modalsArray[e].wrapper.destroy();else for(var t=0;t<this.modalsArray.length;t++)if(this.modalsArray[t].wrapper===e){this.modalsArray.splice(t,1);break}},e.prototype.closeAllModals=function(){for(var e=this.modalsArray.length-1;0<=e;e--)this.modalsArray[e].wrapper.destroy()},Object.defineProperty(e.prototype,"backdropVisible",{get:function(){return 0!==this.modalsArray.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backdropZindex",{get:function(){return 2*this.modalsArray.length},enumerable:!0,configurable:!0}),e.prototype.prompt=function(t,s,i,o,a){void 0===i&&(i=null),void 0===a&&(a=null);var r=new rxjs_1.Subject;return this.openModal("SystemPrompt").subscribe(function(e){e.instance.type=t,e.instance.text=s,e.instance.headertext=i,e.instance.theme=o,e.instance.defaultvalue=a,e.instance.answer.subscribe(function(e){r.next(e),r.complete()})}),r.asObservable()},e.prototype.confirm=function(e,t,s){return void 0===t&&(t=null),void 0===s&&(s=null),this.prompt("confirm",e,t,s)},e.prototype.input=function(e,t,s,i){return void 0===t&&(t=null),void 0===s&&(s=null),void 0===i&&(i=null),this.prompt("input",e,t,s,i)},e.prototype.info=function(e,t,s){return void 0===t&&(t=null),void 0===s&&(s=null),this.prompt("info",e,t,s)},e.prototype.await=function(t){void 0===t&&(t=null);var s=new core_1.EventEmitter;return this.openModal("SystemLoadingModal").subscribe(function(e){e.instance.messagelabel=t,s.subscribe(function(){e.instance.self.destroy()})}),s},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[metadata,footer,toast,modelutilities])],e)}();exports.modal=modal;var helper=function(){function e(e){this.modalservice=e,this.dialog=null,this._base64_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}return e.prototype.confirm=function(e,t){var s=new rxjs_1.Subject;return this.modalservice.confirm(t,e).subscribe(function(e){s.next(e),s.complete()}),s.asObservable()},e.prototype.shuffle=function(e){for(var t,s,i=e.length;i;)s=Math.floor(Math.random()*i--),t=e[i],e[i]=e[s],e[s]=t;return e},e.prototype.encodeBase64=function(e){var t,s,i,o,a,r,n,l="",u=0;for(e=this._utf8_encodeBase64(e);u<e.length;)o=(t=e.charCodeAt(u++))>>2,a=(3&t)<<4|(s=e.charCodeAt(u++))>>4,r=(15&s)<<2|(i=e.charCodeAt(u++))>>6,n=63&i,isNaN(s)?r=n=64:isNaN(i)&&(n=64),l=l+this._base64_keyStr.charAt(o)+this._base64_keyStr.charAt(a)+this._base64_keyStr.charAt(r)+this._base64_keyStr.charAt(n);return l},e.prototype.decodeBase64=function(e){var t,s,i,o,a,r,n="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=this._base64_keyStr.indexOf(e.charAt(l++))<<2|(o=this._base64_keyStr.indexOf(e.charAt(l++)))>>4,s=(15&o)<<4|(a=this._base64_keyStr.indexOf(e.charAt(l++)))>>2,i=(3&a)<<6|(r=this._base64_keyStr.indexOf(e.charAt(l++))),n+=String.fromCharCode(t),64!=a&&(n+=String.fromCharCode(s)),64!=r&&(n+=String.fromCharCode(i));return n=this._utf8_decodeBase64(n)},e.prototype._utf8_encodeBase64=function(e){var t="";e=e.replace(/\r\n/g,"\n");for(var s=0;s<e.length;s++){var i=e.charCodeAt(s);i<128?t+=String.fromCharCode(i):(127<i&&i<2048?t+=String.fromCharCode(i>>6|192):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128)),t+=String.fromCharCode(63&i|128))}return t},e.prototype._utf8_decodeBase64=function(e){for(var t="",s=0,i=0,o=0,a=0;s<e.length;)(i=e.charCodeAt(s))<128?(t+=String.fromCharCode(i),s++):191<i&&i<224?(o=e.charCodeAt(s+1),t+=String.fromCharCode((31&i)<<6|63&o),s+=2):(o=e.charCodeAt(s+1),a=e.charCodeAt(s+2),t+=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a),s+=3);return t},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[modal])],e)}();exports.helper=helper;var googleapiloader=function(){function e(e,t){this.broadcast=e,this.configuration=t,this.apis=[]}return e.prototype._loadScript=function(){var e=document.createElement("script");e.async=!0,e.defer=!0,e.src="https://maps.googleapis.com/maps/api/js?callback=__onGoogleLoaded&key="+this.configuration.data.googleAPI,e.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(e)},e.prototype.isApiLoaded=function(){return!(!window.google||!window.google.maps)},e.prototype.loadApi=function(){var s=this;this._apiLoadingPromise||(this._apiLoadingPromise=new Promise(function(t){window.__onGoogleLoaded=function(e){t("google maps api loaded"),s.broadcast.broadcastMessage("googleapiloader.maps")},s._loadScript()}))},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[broadcast,configurationService])],e)}();exports.googleapiloader=googleapiloader;var LibLoaderService=function(){function e(){this.scripts=[],this.is_ready=!1}return e.prototype.load=function(){for(var t=this,e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];this.is_ready||this.load();var i=[];e.forEach(function(e){i.push(t.loadScript(e))});for(var o=new rxjs_1.Subject,a=0,r=0,n=i;r<n.length;r++){n[r].subscribe(function(e){a++,console.log(a,e)},function(e){a++,console.error(e),o.error(e)},function(){a==i.length&&(o.next(),o.complete())})}return a==i.length?rxjs_1.of(o):o.asObservable()},e.prototype.loadScript=function(e){var s=new rxjs_1.Subject;if(!this.scripts[e])return rxjs_1.of({script:e,loaded:!1,status:"Unknown"});if(this.isLibLoaded(e))return rxjs_1.of({script:e,loaded:!0,status:"Already Loaded"});for(var i=document.createElement("script"),t=function(t){i.type="text/javascript",i.src=t.src,i.readyState?i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,t.loaded=!0,s.next({script:t.src,loaded:!0,status:"Loaded"}),s.complete())}:i.onload=function(){t.loaded=!0,s.next({script:t.src,loaded:!0,status:"Loaded"}),s.complete()},i.onerror=function(e){s.error({script:t.src,loaded:!1,status:"Failed"})},document.getElementsByTagName("head")[0].appendChild(i)},o=0,a=this.scripts[e];o<a.length;o++){t(a[o])}return s.asObservable()},e.prototype.isLibLoaded=function(e){if(this.scripts[e]){for(var t=0,s=this.scripts[e];t<s.length;t++){if(!s[t].loaded)return!1}return!0}return!1},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[])],e)}();exports.LibLoaderService=LibLoaderService;var backend=function(){function e(e,t,s,i,o,a,r,n,l,u){this.toast=e,this.http=t,this.sanitizer=s,this.configurationService=i,this.session=o,this.metadata=a,this.router=r,this.modelutilities=n,this.modalservice=l,this.language=u,this.autoLogout={},this.httpErrorsToReport=[],this.httpErrorReporting=!1,this.httpErrorReportingRetryTime=1e4}return e.prototype.getHeaders=function(){var e=this.session.getSessionHeader();return e=e.set("Accept","application/json")},e.prototype.prepareParams=function(s){var i=new http_1.HttpParams;return s&&Object.keys(s).forEach(function(e){var t=s[e];null!=t&&(i="object"==typeof t?i.append(e,JSON.stringify(t)):"boolean"==typeof t?i.append(e,!0===t?"1":"0"):"number"==typeof t?i.append(e,t+""):i.append(e,t.toString()))}),i},e.prototype.getRequest=function(t,s){var i=this;void 0===t&&(t=""),void 0===s&&(s={});var o=new rxjs_1.Subject;return this.resetTimeOut(),this.http.get(this.configurationService.getBackendUrl()+"/"+encodeURI(t),{headers:this.getHeaders(),observe:"response",params:this.prepareParams(s)}).subscribe(function(e){o.next(e.body),o.complete()},function(e){i.handleError(e,t,"GET",{getParams:s}),o.error(e)}),o.asObservable()},e.prototype.getRawRequest=function(e,t,s,i){void 0===e&&(e=""),void 0===t&&(t={}),void 0===s&&(s="blob"),void 0===i&&(i={}),this.resetTimeOut();var o=this.session.getSessionHeader();for(var a in i)o=o.set(a,i[a]);return this.http.get(this.configurationService.getBackendUrl()+"/"+e,{headers:o,params:this.prepareParams(t),responseType:"blob"})},e.prototype.postRequest=function(t,s,i,o){var a=this;void 0===t&&(t=""),void 0===s&&(s={}),void 0===i&&(i={}),void 0===o&&(o=!0);var r=new rxjs_1.Subject;this.resetTimeOut();var e=this.getHeaders();return e=i?e.set("Content-Type","application/json"):e.set("Content-Type","application/x-www-form-urlencoded"),this.http.post(this.configurationService.getBackendUrl()+"/"+encodeURI(t),i,{headers:e,observe:"response",params:this.prepareParams(s)}).subscribe(function(e){r.next(e.body),r.complete()},function(e){a.handleError(e,t,"POST",{getParams:s,body:i},o),r.error(e)}),r.asObservable()},e.prototype.getDownloadPostRequestFile=function(t,s,i){var o=this;void 0===t&&(t=""),void 0===s&&(s={}),void 0===i&&(i={});var a=new rxjs_1.Subject;this.resetTimeOut();var e=this.getHeaders();return e=e.set("Accept","*/*"),this.http.post(this.configurationService.getBackendUrl()+"/"+t,i,{headers:e,observe:"response",params:this.prepareParams(s),responseType:"blob"}).subscribe(function(e){var t=window.URL.createObjectURL(e.body);a.next(t),a.complete()},function(e){o.handleError(e,t,"POST",{getParams:s,body:i}),a.error(e)}),a.asObservable()},e.prototype.getLinkToDownload=function(t,s,i,o,e){var a=this;void 0===s&&(s="GET"),void 0===i&&(i=null),void 0===o&&(o=null),void 0===e&&(e=null);var r=new rxjs_1.Subject,n=this.getHeaders();return n=n.set("Accept","*/*"),this.http.request(s,this.configurationService.getBackendUrl()+"/"+t,{body:o,headers:n,observe:"response",params:this.prepareParams(i),responseType:"blob"}).subscribe(function(e){if(200==e.status){var t=window.URL.createObjectURL(e.body);r.next(t),r.complete()}else r.error(e.statusText)},function(e){a.handleError(e,t,s,{getParams:i,body:o}),r.error(e)}),r.asObservable()},e.prototype.downloadFile=function(e,i){void 0===i&&(i=null);var o=new rxjs_1.Subject;return this.getLinkToDownload(e.route,e.method,e.params,e.body,e.headers).subscribe(function(e){var t=e,s=document.createElement("a");s.href=t,s.download=i,s.click(),s.remove(),o.next(),o.complete()}),o.asObservable()},e.prototype.putRequest=function(t,s,i){var o=this;void 0===t&&(t=""),void 0===s&&(s={}),void 0===i&&(i={});var a=new rxjs_1.Subject;return this.resetTimeOut(),this.http.put(this.configurationService.getBackendUrl()+"/"+t,i,{headers:this.getHeaders(),observe:"response",params:this.prepareParams(s)}).subscribe(function(e){a.next(e.body),a.complete()},function(e){o.handleError(e,t,"PUT",{getParams:s,body:i}),a.error(e)}),a.asObservable()},e.prototype.deleteRequest=function(t,s){var i=this;void 0===t&&(t=""),void 0===s&&(s={});var o=new rxjs_1.Subject;return this.resetTimeOut(),this.http.delete(this.configurationService.getBackendUrl()+"/"+t,{headers:this.getHeaders(),params:this.prepareParams(s)}).subscribe(function(e){o.next(!0),o.complete()},function(e){i.handleError(e,t,"DELETE",{getParams:s}),o.error(e)}),o.asObservable()},e.prototype.handleError=function(e,t,s,i,o){switch(void 0===i&&(i=null),void 0===o&&(o=!0),e.status){case 401:this.toast.sendAlert(this.language.getLabel("ERR_LOGGED_OUT_SESSION_EXPIRED"),"error",null,!1),this.modalservice.closeAllModals(),this.session.endSession(),this.router.navigate(["/login"]);break;case 0:o&&this.reportError(e,t,s,i)}},e.prototype.reportError=function(e,t,s,i){var o=this;this.httpErrorsToReport.push({clientTime:(new Date).toISOString(),clientInfo:{sessionId:this.session.authData.sessionId,userId:this.session.authData.userId,userName:this.session.authData.userName},route:t,method:s,getParams:i.getParams?i.getParams:null,error:e,body:i.body?i.body:null}),this.httpErrorReporting||(this.httpErrorReporting=!0,window.setTimeout(function(){return o.errorsToBackend()},this.httpErrorReportingRetryTime))},e.prototype.errorsToBackend=function(){var t=this;this.httpErrorsToReport.length&&this.postRequest("httperrors",null,{errors:this.httpErrorsToReport},!1).subscribe(function(){t.httpErrorsToReport.length=0,t.httpErrorReporting=!1},function(e){t.httpErrorReporting=!0,window.setTimeout(function(){return t.errorsToBackend()},t.httpErrorReportingRetryTime)})},e.prototype.resetTimeOut=function(){var e=this;0<this.configurationService.data.autoLogout&&(window.clearTimeout(this.autoLogout),this.autoLogout=window.setTimeout(function(){return e.logout()},6e4*parseInt(this.configurationService.data.autoLogout,10)))},e.prototype.logout=function(){this.session.authData.sessionId&&(this.toast.sendAlert("you have been logged out","error","",!1),this.session.endSession()),this.router.navigate(["/login"])},e.prototype.get=function(s,e,t){var i=this;void 0===t&&(t="");var o=new rxjs_1.Subject,a={};return t&&(a.trackaction=t),this.getRequest("module/"+s+"/"+e,a).subscribe(function(e){for(var t in e)e[t]=i.backend2spice(s,t,e[t]);o.next(e),o.complete()},function(e){o.error(e),o.complete()}),o.asObservable()},e.prototype.all=function(r,e){var n=this;void 0===e&&(e={});var l=new rxjs_1.Subject;return e.limit||(e.limit=-99),e.fields||(e.fields="*"),this.getRequest("module/"+r,e).subscribe(function(e){for(var t=e.list,s=0,i=t;s<i.length;s++){var o=i[s];for(var a in o)o[a]=n.backend2spice(r,a,o[a])}l.next(t),l.complete()}),l.asObservable()},e.prototype.getDuplicates=function(e,t){var s=new rxjs_1.Subject;return this.getRequest("module/"+e+"/"+t+"/duplicates").subscribe(function(e){s.next(e),s.complete()}),s.asObservable()},e.prototype.checkDuplicates=function(e,t){var s=new rxjs_1.Subject;return this.postRequest("module/"+e+"/duplicates",{},t).subscribe(function(e){s.next(e),s.complete()}),s.asObservable()},e.prototype.getAudit=function(e,t,s){void 0===s&&(s={});var i=new rxjs_1.Subject;return this.getRequest("module/"+e+"/"+t+"/auditlog",s).subscribe(function(e){i.next(e),i.complete()},function(e){e.error.error&&e.error.error.errorCode&&"moduleNotAudited"===e.error.error.errorCode&&(i.error(e.error.error.errorCode),i.complete())}),i.asObservable()},e.prototype.getList=function(i,e,t,s,o){var a=this;void 0===s&&(s=[]),void 0===o&&(o={});var r=new rxjs_1.Subject,n=(o.start&&o.start,o.limit&&o.limit,o);return n.searchfields=o.searchfields,n.offset=o.start?o.start:0,n.limit=o.limit?o.limit:25,o.listid&&(n.listid=o.listid),e&&t&&(n.sortfield=e,n.sortdirection=t),s&&0<s.length&&(n.fields=JSON.stringify(s)),this.getRequest("module/"+i,n).subscribe(function(e){try{for(var t in e.list)for(var s in e.list[t])e.list[t][s]=a.backend2spice(i,s,e.list[t][s])}catch(e){r.next([]),r.complete()}r.next(e),r.complete()}),r.asObservable()},e.prototype.save=function(t,e,s){var i=this,o=new rxjs_1.Subject;return this.postRequest("module/"+t+"/"+e,{},this.modelutilities.spiceModel2backend(t,s)).subscribe(function(e){o.next(i.modelutilities.backendModel2spice(t,e)),o.complete()},function(e){o.error(e),o.complete()}),o.asObservable()},e.prototype.delete=function(e,t){var s=new rxjs_1.Subject;return this.deleteRequest("module/"+e+"/"+t).subscribe(function(e){s.next(!0),s.complete()}),s.asObservable()},e.prototype.getRecent=function(e,t){void 0===e&&(e=""),void 0===t&&(t=0);var s=new rxjs_1.Subject,i={};return e&&(i.module=e),0<t&&(i.limit=t),this.getRequest("spiceui/core/recent",i).subscribe(function(e){s.next(e),s.complete()}),s.asObservable()},e.prototype.addListType=function(e,t){var s=new rxjs_1.Subject;return this.postRequest("spiceui/core/modules/"+e+"/listtypes",{},JSON.stringify(t)).subscribe(function(e){s.next(e),s.complete()}),s.asObservable()},e.prototype.setListType=function(e,t,s){var i=new rxjs_1.Subject;return this.postRequest("spiceui/core/modules/"+t+"/listtypes/"+e,{},JSON.stringify(s)).subscribe(function(e){i.next(e),i.complete()}),i.asObservable()},e.prototype.deleteListType=function(e){var t=new rxjs_1.Subject;return this.deleteRequest("spiceui/core/modules/"+module+"/listtypes/"+e).subscribe(function(e){t.next(e),t.complete()}),t.asObservable()},e.prototype.backend2spice=function(e,t,s){return this.modelutilities.backend2spice(e,t,s)},e.prototype.spice2backend=function(e,t,s){return this.modelutilities.spice2backend(e,t,s)},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[toast,http_1.HttpClient,platform_browser_1.DomSanitizer,configurationService,session,metadata,router_1.Router,modelutilities,modal,language])],e)}();exports.backend=backend;var AppDataService=function(){function e(e){this.backend=e,this._modules=[],this.loadModules()}return Object.defineProperty(e.prototype,"modules",{get:function(){return this._modules},enumerable:!0,configurable:!0}),e.prototype.loadModules=function(){var t=this;this.backend.getRequest("spiceui/admin/modules").subscribe(function(e){t._modules=e})},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[backend])],e)}();exports.AppDataService=AppDataService;var recent=function(){function e(e,t,s,i){var o=this;this.backend=e,this.broadcast=t,this.configurationService=s,this.session=i,this.items=[],this.moduleItems={},this.broadcast.message$.subscribe(function(e){return o.handleMessage(e)})}return e.prototype.handleMessage=function(s){var i=this;switch(s.messagetype){case"model.save":this.items.some(function(e,t){if(e.module_name===s.messagedata.module&&e.item_id==s.messagedata.id)return i.items[t].item_summary=s.messagedata.data.summary_text,!0}),this.moduleItems[s.messagedata.module]&&this.moduleItems[s.messagedata.module].some(function(e,t){if(e.item_id==s.messagedata.id)return i.moduleItems[s.messagedata.module][t].item_summary=s.messagedata.data.summary_text,!0});break;case"model.delete":this.items.some(function(e,t){if(e.module_name===s.messagedata.module&&e.item_id==s.messagedata.id)return i.items.splice(t,1),!0}),this.moduleItems[s.messagedata.module]&&this.moduleItems[s.messagedata.module].some(function(e,t){if(e.item_id==s.messagedata.id)return i.items.splice(t,1),!0})}},e.prototype.trackItem=function(s,i,e){var o=this;for(this.items.some(function(e,t){if(e.module_name===s&&e.item_id==i)return o.items.splice(t,1),!0}),this.items.splice(0,0,{item_id:i,module_name:s,item_summary:e});50<this.items.length;)this.items.pop();if(this.moduleItems[s])for(this.moduleItems[s].some(function(e,t){if(e.item_id==i)return o.moduleItems[s].splice(t,1),!0}),this.moduleItems[s].splice(0,0,{item_id:i,module_name:s,item_summary:e});5<this.moduleItems[s].length;)this.moduleItems[s].pop()},e.prototype.getRecent=function(o){var a=this;if(sessionStorage[window.btoa("recent"+this.session.authData.sessionId)]&&0<sessionStorage[window.btoa("recent"+this.session.authData.sessionId)].length&&!this.configurationService.data.developerMode){for(var e=0,t=this.session.getSessionData("recent");e<t.length;e++){var s=t[e];this.items.push(s)}o.next("getRecent")}else this.backend.getRecent("",50).subscribe(function(e){a.session.setSessionData("recent",e);for(var t=0,s=e;t<s.length;t++){var i=s[t];a.items.push(i)}o.next("getRecent")})},e.prototype.getModuleRecent=function(o){var a=this;if("Home"==o)return rxjs_1.of(this.items.slice(0,5));if(this.moduleItems[o])return rxjs_1.of(this.moduleItems[o]);var r=new rxjs_1.Subject;return this.moduleItems[o]||this.backend.getRecent(o,5).subscribe(function(e){a.moduleItems[o]=[];for(var t=0,s=e;t<s.length;t++){var i=s[t];a.moduleItems[o].push(i)}r.next(a.moduleItems[o]),r.complete()}),r.asObservable()},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[backend,broadcast,configurationService,session])],e)}();exports.recent=recent;var userpreferences=function(){function e(e,t,s){this.backend=e,this.toast=t,this.l=s,this.preferences={global:{}},this.unchangedPreferences={global:{}},this.preferencesComplete=!0,this.defaults={currency:-99,datef:"d.m.Y",dec_sep:",",num_grp_sep:".",timef:"H:i",timezone:"Europe/Vienna",default_currency_significant_digits:2,default_locale_name_format:"l, f",week_day_start:0},this.formats={nameFormats:[],loaded:!1},this.toUse=this.preferences.global}return e.prototype.getPreferences=function(t){this.loadPreferences().subscribe(function(e){t.next("getPreferences")})},e.prototype.loadPreferences=function(t){var s=this;void 0===t&&(t="global");var i=new rxjs_1.Subject;return this.backend.getRequest("user/preferences/"+t).subscribe(function(e){s.preferences[t]=_.extendOwn(s.preferences[t],e),"global"===t?(s.unchangedPreferences.global=_.clone(e),s.completePreferencesWithDefaults()):s.unchangedPreferences[t]=_.clone(e),i.next(e)}),i.asObservable()},e.prototype.completePreferencesWithDefaults=function(){var s=this,i=!1;_.each(this.defaults,function(e,t){"string"==typeof s.preferences.global[t]?s.preferences.global[t]||(s.preferences.global[t]=e,i=!0):void 0!==s.preferences.global[t]&&null!==s.preferences.global[t]||(s.preferences.global[t]=e,i=!0)}),this.preferencesComplete=!i},e.prototype.getPreference=function(e,t){void 0===t&&(t="global");try{return this.preferences[t][e]}catch(e){return!1}},e.prototype.setPreference=function(t,s,e,i){var o=this;if(void 0===e&&(e=!0),void 0===i&&(i="global"),e){var a={};a[t]=s,this.backend.postRequest("user/preferences/"+i,{},a).subscribe(function(e){o.preferences[i]||(o.preferences[i]={}),o.preferences[i][t]=s,o.unchangedPreferences[i][t]=s,o.completePreferencesWithDefaults()})}else this.preferences[i][t]=s,this.completePreferencesWithDefaults()},e.prototype.setPreferences=function(e,o){var a=this;void 0===o&&(o="global");var r=new rxjs_1.Subject;return this.backend.postRequest("user/preferences/"+o,{},e).subscribe(function(e){for(var t=0,s=a.preferences[o];t<s.length;t++){var i=s[t];e.hasOwnProperty(i)?a.preferences[o]=e[i]:delete a.preferences[o][i]}a.unchangedPreferences[o]=e,a.completePreferencesWithDefaults(),r.next(!0)},function(e){r.error(e)}),r},e.prototype.getDateFormat=function(){if(this.toUse.datef){var e=this.toUse.datef;return this.jsDateFormat2momentDateFormat(e)}return"YYYY-MM-DD"},e.prototype.jsDateFormat2momentDateFormat=function(e){return e.replace("Y","YYYY").replace("m","MM").replace("d","DD")},e.prototype.getTimeFormat=function(){if(this.toUse.timef){var e=this.toUse.timef;return this.jsTimeFormat2momentTimeFormat(e)}return"hh:mm"},e.prototype.jsTimeFormat2momentTimeFormat=function(e){return e.replace("H","HH").replace("h","hh").replace("i","mm")},e.prototype.needFormats=function(){this.formats.loaded||this.loadFormats()},e.prototype.loadFormats=function(){var o=this,a=new rxjs_1.Subject;return this.formats.nameFormats.length=0,this.formats.loaded=!1,this.backend.getRequest("user/preferencesformats").subscribe(function(e){for(var t=0,s=e.nameFormats;t<s.length;t++){var i=s[t];o.formats.nameFormats.push({name:i,example:o.translateNameFormat(i)})}o.formats.loaded=!0,a.next(!0)}),a.asObservable()},e.prototype.translateNameFormat=function(e){for(var t="",s=0;s<e.length;s++)switch(e.charAt(s)){case"t":t+=this.l.getLabel("LBL_LOCALE_NAME_EXAMPLE_TITLE");break;case"f":t+=this.l.getLabel("LBL_LOCALE_NAME_EXAMPLE_FIRST");break;case"l":t+=this.l.getLabel("LBL_LOCALE_NAME_EXAMPLE_LAST");break;case"s":t+=this.l.getLabel("LBL_LOCALE_NAME_EXAMPLE_SALUTATION");break;default:t+=e.charAt(s)}return t},e.prototype.formatMoney=function(e,t,s,i,o){void 0===t&&(t=this.toUse.default_currency_significant_digits),void 0===s&&(s=3),void 0===i&&(i=this.toUse.num_grp_sep),void 0===o&&(o=this.toUse.dec_sep);var a="\\d(?=(\\d{"+s+"})+"+(0<t?"\\D":"$")+")";return e.toFixed(Math.max(0,~~t)).replace(".",o).replace(new RegExp(a,"g"),"$&"+i)},e.prototype.formatDate=function(e){return moment(e).format(this.getDateFormat())},e.prototype.formatDateTime=function(e){return moment(e).format(this.getDateFormat())+" "+moment(e).format("HH:mm:ss")},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[backend,toast,language])],e)}();exports.userpreferences=userpreferences;var territories=function(){function e(e,t,s,i){this.backend=e,this.metadata=t,this.configurationService=s,this.session=i,this.userTerritories={},this.addTerritories={}}return e.prototype.getTerritories=function(e){sessionStorage[window.btoa("territorries"+this.session.authData.sessionId)]&&0<sessionStorage[window.btoa("territorries"+this.session.authData.sessionId)].length&&!this.configurationService.data.developerMode?(this.userTerritories=this.session.getSessionData("territorries"),e.next("getTerritorries")):this.loadTerritories().subscribe(function(){e.next("getTerritorries")})},e.prototype.loadTerritories=function(){for(var t=this,s=new rxjs_1.Subject,e=[],i=0,o=this.metadata.getModules();i<o.length;i++){var a=o[i];"Home"!==a&&e.push(a)}return this.backend.getRequest("territories").subscribe(function(e){t.session.setSessionData("territorries",e),t.userTerritories=e,s.next(!0),s.complete()}),s.asObservable()},e.prototype.loadTerritoryName=function(t){var s=this;this.addTerritories[t]="...",this.backend.getRequest("territories/"+t).subscribe(function(e){e.id===t?s.addTerritories[t]=e.name:s.addTerritories[t]="error"})},e.prototype.searchTerritories=function(e,t,s,i){void 0===s&&(s=5),void 0===i&&(i=[]);for(var o=[],a=0,r=this.userTerritories[e];a<r.length;a++){var n=r[a];if(0<=n.name.toLowerCase().indexOf(t.toLowerCase())&&i.indexOf(n.id)<0&&o.push(n),o.length>=s)return o}return o},e.prototype.isUserTerritory=function(e,t){var s=!1;return this.userTerritories[e].some(function(e){if(e.id===t)return s=!0}),s},e.prototype.getTerritoryName=function(e,t){var s="";return this.userTerritories[e].some(function(e){if(e.id===t)return s=e.name,!0}),""===s&&(this.addTerritories[t]||this.loadTerritoryName(t),s=this.addTerritories[t]),s},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[backend,metadata,configurationService,session])],e)}();exports.territories=territories;var favorite=function(){function e(e,t,s,i){var o=this;this.backend=e,this.broadcast=t,this.configurationService=s,this.session=i,this.isFavorite=!1,this.isEnabled=!1,this.favorites=[],this.currentModule="",this.currentId="",this.broadcast.message$.subscribe(function(e){return o.handleMessage(e)})}return e.prototype.handleMessage=function(s){var i=this;switch(s.messagetype){case"model.save":this.favorites.some(function(e,t){if(e.module_name===s.messagedata.module&&e.item_id==s.messagedata.id)return i.favorites[t].item_summary=s.messagedata.data.summary_text,!0})}},e.prototype.enable=function(t,s){var i=this;this.isEnabled=!0,this.currentModule=t,this.currentId=s,this.favorites.some(function(e){if(e.module_name===t&&e.item_id===s)return i.isFavorite=!0})},e.prototype.disable=function(){this.isEnabled=!1,this.isFavorite=!1},e.prototype.loadFavorites=function(t){var s=this;sessionStorage[window.btoa("favorites"+this.session.authData.sessionId)]&&0<sessionStorage[window.btoa("favorites"+this.session.authData.sessionId)].length&&!this.configurationService.data.developerMode?(this.favorites=this.session.getSessionData("favorites"),t.next("loadFavorites")):this.backend.getRequest("spiceui/core/favorites").subscribe(function(e){s.session.setSessionData("favorites",e),s.favorites=e,t.next("loadFavorites")})},e.prototype.getFavorites=function(e){for(var t=[],s=0,i=this.favorites;s<i.length;s++){var o=i[s];o.module_name===e&&t.push({item_id:o.item_id,item_summary:o.item_summary})}return t},e.prototype.setFavorite=function(){var t=this;this.backend.postRequest("spiceui/core/favorites/"+this.currentModule+"/"+this.currentId).subscribe(function(e){t.favorites.splice(0,0,{item_id:e.id,module_name:e.module,item_summary:e.summary_text}),t.isFavorite=!0})},e.prototype.deleteFavorite=function(){var s=this;this.backend.deleteRequest("spiceui/core/favorites/"+this.currentModule+"/"+this.currentId).subscribe(function(e){s.favorites.some(function(e,t){if(e.module_name===s.currentModule&&e.item_id===s.currentId)return s.favorites.splice(t,1),!0}),s.isFavorite=!1})},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[backend,broadcast,configurationService,session])],e)}();exports.favorite=favorite;var reminder=function(){function e(e,t,s,i){var o=this;this.backend=e,this.broadcast=t,this.configurationService=s,this.session=i,this.reminders=[],this.loaded$=new core_1.EventEmitter,this.broadcast.message$.subscribe(function(e){return o.handleMessage(e)})}return e.prototype.handleMessage=function(s){var i=this;switch(s.messagetype){case"model.save":this.reminders.some(function(e,t){if(e.module_name===s.messagedata.module&&e.item_id==s.messagedata.id)return i.reminders[t].item_summary=s.messagedata.data.summary_text,!0})}},e.prototype.loadReminders=function(o){var a=this;sessionStorage[window.btoa("reminders"+this.session.authData.sessionId)]&&0<sessionStorage[window.btoa("reminders"+this.session.authData.sessionId)].length&&!this.configurationService.data.developerMode?(this.reminders=this.session.getSessionData("reminders"),o.next("loadReminders")):this.backend.getRequest("spiceui/core/reminders").subscribe(function(e){a.session.setSessionData("reminders",e);for(var t=0,s=e;t<s.length;t++){var i=s[t];i.reminder_date=moment.utc(i.reminder_date),a.reminders.push(i)}a.loaded$.emit(!0),delete a.loaded$,o.next("loadReminders")})},e.prototype.getReminder=function(t,s){var i=!1;return this.reminders.some(function(e){if(e.module_name===t&&e.item_id===s)return i=e.reminder_date,!0}),i},e.prototype.getReminders=function(){for(var e=[],t=0,s=this.reminders;t<s.length;t++){var i=s[t];i.module_name===module&&e.push({item_id:i.item_id,item_summary:i.item_summary})}return e},e.prototype.setReminder=function(t,s){var i=this;this.backend.postRequest("spiceui/core/reminders/"+t.module+"/"+t.id+"/"+s.format("YYYY-MM-DD")).subscribe(function(e){i.reminders.splice(0,0,{item_id:t.id,module_name:t.module,item_summary:t.data.summary_text,reminder_date:s})})},e.prototype.deleteReminder=function(s,i){var o=this,t=new rxjs_1.Subject;return this.backend.deleteRequest("spiceui/core/reminders/"+s+"/"+i).subscribe(function(e){o.reminders.some(function(e,t){if(e.module_name===s&&e.item_id===i)return o.reminders.splice(t,1),!0}),t.next(!0),t.complete()}),t.asObservable()},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[backend,broadcast,configurationService,session])],e)}();exports.reminder=reminder;var assistant=function(){function e(e,t,s){var i=this;this.modelutilities=e,this.backend=t,this.broadcast=s,this.assitantItems=[],this.assistantFilters={objectfilters:[],timefilter:"all"},this.initialized=!1,this.loading=!1,this.activityObjects=["Tasks","Meetings","Calls","Opportunities","Reminders"],this.completeStatuses=["Completed","Deferred","Held","Not Held"],this.broadcast.message$.subscribe(function(e){i.handleMessage(e)})}return e.prototype.handleMessage=function(t){var s=this,i=0;switch(t.messagetype){case"model.delete":case"assistant.complete":this.assitantItems.some(function(e){if(e.id==t.messagedata.id)return s.assitantItems.splice(i,1),!0;i++});break;case"model.save":this.assitantItems.some(function(e){if(e.id==t.messagedata.id)return t.messagedata.data.status&&0<=s.completeStatuses.indexOf(t.messagedata.data.status)?s.assitantItems.splice(i,1):e.data=t.messagedata.data,!0;i++})}},e.prototype.initlaize=function(){this.initialized||(this.loadItems(),this.initialized=!0)},e.prototype.loadItems=function(){var r=this;this.loading=!0,this.assitantItems=[];var n=new rxjs_1.Subject,e={objectfilters:JSON.stringify(this.assistantFilters.objectfilters),timefilter:this.assistantFilters.timefilter};return this.backend.getRequest("assistant/list",e).subscribe(function(e){for(var t=0,s=e;t<s.length;t++){var i=s[t],o=[];for(var a in i.data)o[a]=r.modelutilities.backend2spice(i.module,a,i.data[a]);r.assitantItems.push({id:i.id,module:i.module,data:o})}n.next(r.assitantItems),n.complete(),r.loading=!1}),n.asObservable()},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[modelutilities,backend,broadcast])],e)}();exports.assistant=assistant;var currency=function(){function e(e,t,s,i){this.backend=e,this.http=t,this.configurationService=s,this.session=i,this.currencies=[]}return e.prototype.loadCurrencies=function(t){var s=this;sessionStorage[window.btoa("currencies"+this.session.authData.sessionId)]&&0<sessionStorage[window.btoa("currencies"+this.session.authData.sessionId)].length&&!this.configurationService.data.developerMode?(this.currencies=this.session.getSessionData("currencies"),t.next("loadCurrencies")):this.backend.getRequest("currencies").subscribe(function(e){s.session.setSessionData("currencies",e),s.currencies=e,t.next("loadCurrencies")})},e.prototype.getCurrencies=function(){for(var e=[],t=0,s=this.currencies;t<s.length;t++){var i=s[t];e.push({id:i.id,name:i.name,iso:i.iso,symbol:i.symbol})}return e},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[backend,http_1.HttpClient,configurationService,session])],e)}();exports.currency=currency;var loader=function(){function e(e,t,s,i,o,a,r,n,l,u){var d=this;this.http=e,this.configurationService=t,this.language=s,this.territories=i,this.metadata=o,this.recent=a,this.favorite=r,this.reminder=n,this.currency=l,this.userpreferences=u,this.module="",this.id="",this.data={},this.loaderHandler=new rxjs_1.Subject,this.start="",this.counterCompleted=0,this.progress=0,this.activeLoader="",this.loadPhase="primary",this.loadElements={primary:[{name:"loadComponents",display:"Components",status:"initial",action:function(e){e.metadata.loadComponents(e.loaderHandler)}},{name:"loadFieldSets",display:"Fieldsets",status:"initial",action:function(e){e.metadata.loadFieldSets(e.loaderHandler)}},{name:"loadValidationRules",display:"Validations",status:"initial",action:function(e){e.metadata.loadValidationRules(e.loaderHandler)}},{name:"loadModuleDefinitions",display:"Module Definitions",status:"initial",action:function(e){e.metadata.loadModuleDefinitions(e.loaderHandler)}},{name:"loadFieldDefs",display:"Field Definitions",status:"initial",action:function(e){e.metadata.loadFieldDefs(e.loaderHandler)}},{name:"getLanguage",display:"Language",status:"initial",action:function(e){e.language.getLanguage(e.loaderHandler)}},{name:"getPreferences",display:"Preferences",status:"initial",action:function(e){e.userpreferences.getPreferences(e.loaderHandler)}},{name:"loadCurrencies",display:"Currencies",status:"initial",action:function(e){e.currency.loadCurrencies(e.loaderHandler)}}],secondary:[{name:"getTerritories",display:"Territories",status:"initial",action:function(e){e.territories.getTerritories(e.loaderHandler)}},{name:"getRecent",display:"Recently viewed",status:"initial",action:function(e){e.recent.getRecent(e.loaderHandler)}},{name:"loadFavorites",display:"Favorites",status:"initial",action:function(e){e.favorite.loadFavorites(e.loaderHandler)}},{name:"loadReminders",display:"Reminders",status:"initial",action:function(e){e.reminder.loadReminders(e.loaderHandler)}},{name:"loadHtmlStyling",display:"HTML Styling",status:"initial",action:function(e){e.metadata.loadHtmlStyling(e.loaderHandler)}}]},this.loaderHandler.subscribe(function(e){return d.handleLoaderHandler()})}return e.prototype.load=function(){return this.loadComplete=new rxjs_1.Subject,this.resetLoader(),this.start=performance.now(),this.handleLoaderHandler(),this.loadComplete.asObservable()},e.prototype.reloadPrimary=function(){this.loadComplete=new rxjs_1.Subject,this.loadPhase="primary",this.progress=0;for(var e=this.counterCompleted=0,t=this.loadElements.primary;e<t.length;e++){t[e].status="initial"}return this.start=performance.now(),this.handleLoaderHandler(),this.loadComplete.asObservable()},e.prototype.resetLoader=function(){this.counterCompleted=0,this.progress=0,this.loadPhase="primary";for(var e=0,t=this.loadElements.primary;e<t.length;e++){t[e].status="initial"}for(var s=0,i=this.loadElements.secondary;s<i.length;s++){i[s].status="initial"}},e.prototype.reset=function(){this.counterCompleted=0;for(var e=this.progress=0,t=this.loadElements;e<t.length;e++){t[e].status="initial"}},e.prototype.setComplete=function(){var e=this;500<performance.now()-this.start?this.complete():setTimeout(function(){return e.complete()},500)},e.prototype.complete=function(){this.loadComplete.next(!0),this.loadComplete.complete()},e.prototype.handleLoaderHandler=function(){for(var e=!1,t=0,s=this.loadElements[this.loadPhase];t<s.length;t++){var i=s[t];if("active"===i.status)i.status="completed",this.progress=++this.counterCompleted/this.loadElements.primary.length*100,100<this.progress&&this.progress;else if("initial"===i.status){i.status="active",i.action(this),e=!0,this.activeLoader=i.display;break}}!1===e&&"primary"==this.loadPhase&&(this.setComplete(),this.loadPhase="secondary",this.handleLoaderHandler())},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.HttpClient,configurationService,language,territories,metadata,recent,favorite,reminder,currency,userpreferences])],e)}();exports.loader=loader;var loginService=function(){function e(e,t,s,i,o,a){this.configurationService=e,this.http=t,this.router=s,this.loader=i,this.toast=o,this.session=a,this.redirectUrl="",this.authData={userName:"",password:""},this.oauthToken="",this.accessToken="",this.loginSuccessful=new rxjs_1.Subject}return e.prototype.login=function(){var e,s=this,t="",i={};if(0<this.authData.userName.length&&0<this.authData.password.length){var o=this.authData.userName.indexOf("#as#");-1<o&&(e=this.authData.userName.slice(0,o),this.authData.userName=this.authData.userName.slice(o+4));var a=new http_1.HttpHeaders;a=a.set("Authorization","Basic "+btoa(this.authData.userName+":"+this.authData.password)),t=this.configurationService.getBackendUrl()+"/login",e&&(t+="?byDev="+encodeURIComponent(e)),i={headers:a}}else{if(!(0<this.oauthToken.length))throw new Error("Cannot Log In");var r={oauthToken:this.oauthToken,accessToken:this.accessToken};t=this.configurationService.getBackendUrl()+"/google_oauth/token",i={params:r}}return this.http.get(t,i).subscribe(function(e){0==e.result&&s.toast.sendToast("error authenticating","error",e.error);var t=e;s.session.authData.sessionId=t.id,s.session.authData.userId=t.userid,s.session.authData.userName=t.user_name,s.session.authData.userimage=t.user_image,s.session.authData.first_name=t.first_name,s.session.authData.last_name=t.last_name,s.session.authData.display_name=t.display_name,s.session.authData.email=t.email,s.session.authData.admin=1==t.admin,s.session.authData.dev=1==t.dev,s.session.authData.portalOnly="1"===t.portal_only,s.session.authData.renewPass="1"===t.renewPass,s.session.authData.googleToken=t.access_token,sessionStorage["OAuth-Token"]=s.session.authData.sessionId,sessionStorage[btoa(s.session.authData.sessionId+":backendurl")]=btoa(s.configurationService.getBackendUrl()),sessionStorage[btoa(s.session.authData.sessionId+":siteid")]=btoa(s.configurationService.getSiteId()),s.session.authData.renewPass||s.load(),s.loginSuccessful.next(!0),s.loginSuccessful.complete()},function(e){switch(e.status){case 401:s.toast.sendToast("error authenticating","error","Wrong username and/or password")}s.loginSuccessful.next(!1),s.loginSuccessful.error("Not logged in")}),this.loginSuccessful.asObservable()},e.prototype.load=function(){var t=this;this.loader.load().subscribe(function(e){return t.redirect(e)})},e.prototype.redirect=function(e){!0===e&&(this.session.authData.loaded=!0,this.toast.clearAll(),this.redirectUrl?(this.router.navigate([this.redirectUrl]),this.redirectUrl=""):this.router.navigate(["/module/Home"]))},e.prototype.logout=function(){this.http.delete(this.configurationService.getBackendUrl()+"/login?session_id="+this.session.authData.sessionId),this.session.endSession(),this.loader.reset(),this.router.navigate(["/login"])},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[configurationService,http_1.HttpClient,router_1.Router,loader,toast,session])],e)}();exports.loginService=loginService;var loginCheck=function(){function e(e,t,s,i){this.login=e,this.session=t,this.router=s,this.loader=i}return e.prototype.canActivate=function(e,t){return!(!this.session||!this.session.authData.sessionId)||(this.login.redirectUrl=t.url,this.router.navigate(["/login"]),!1)},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[loginService,session,router_1.Router,loader])],e)}();exports.loginCheck=loginCheck;var dockedComposer=function(){function e(e){this.modelutilities=e,this.composers=[],this.calls=[],this.hiddenComposers=[],this.calls=[]}return e.prototype.addComposer=function(e,t){t?this.composers.splice(0,0,{module:e,id:t.id,name:t.summary_text,model:{module:e,id:t.id,data:t.data}}):this.composers.splice(0,0,{module:e,id:this.modelutilities.generateGuid(),name:"",model:{}})},e.prototype.focusComposer=function(i){var o=this;this.composers.some(function(e,t){if(e.id==i){var s=o.composers.splice(t,1);return o.composers.unshift(s.shift()),!0}})},Object.defineProperty(e.prototype,"maxComposers",{get:function(){return Math.floor((window.innerWidth-70)/500)},enumerable:!0,configurable:!0}),e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[modelutilities])],e)}();exports.dockedComposer=dockedComposer;var fts=function(){function e(e,t,s,i,o,a){this.backend=e,this.http=t,this.configurationService=s,this.session=i,this.modelutilities=o,this.metadata=a,this.hits=[],this.found=0,this.runningsearch=void 0,this.runningmodulesearch=void 0,this.searchTerm="",this.searchSort={},this.searchAggregates={},this.searchModules=[],this.modulefilter="",this.moduleSearchresults=[],this.lastSearchParams={},this.gloablSearchResults={},this.getSearchModules()}return Object.defineProperty(e.prototype,"loadedSearchModules",{get:function(){var t=this;return this.searchModules.filter(function(e){return t.metadata.checkModuleAcl(e,"list")})},enumerable:!0,configurable:!0}),e.prototype.transformHits=function(e){for(var t=[],s=0,i=e;s<i.length;s++){var o=i[s];t.push(this.tranformHit(o))}return t},e.prototype.tranformHit=function(e){for(var t in e._source)e._source.hasOwnProperty(t)&&"string"==typeof e._source[t]&&(e._source[t]=e._source[t]);return e},e.prototype.search=function(e,t){var s=this;void 0===t&&(t=5),this.searchTerm=e,this.runningsearch&&this.runningsearch.unsubscribe(),this.resetData(),this.runningsearch=this.backend.postRequest("search",{},{size:t,searchterm:e,modules:this.loadedSearchModules.join(",")}).subscribe(function(e){s.hits=e.hits.hits,s.found=e.hits.total,s.runningsearch=void 0})},e.prototype.searchByModules=function(s,i,o,e,t,a,r){var n=this;void 0===i&&(i=[]),void 0===o&&(o=10),void 0===e&&(e={}),void 0===t&&(t={}),void 0===a&&(a=!1),void 0===r&&(r="");var l=new rxjs_1.Subject;return 0===i.length&&(i=this.loadedSearchModules),-1!=s.indexOf("%")&&(s=s.replace(/%/g,"*")),s=s.trim(),this.searchTerm=s,this.searchAggregates=e,this.searchSort=t,this.modulefilter=r,this.runningmodulesearch&&this.runningmodulesearch.unsubscribe(),this.runningmodulesearch=this.backend.postRequest("search",{},{modules:0<i.length?i.join(","):"",searchterm:s,records:o,owner:a,aggregates:this.searchAggregates,sort:this.searchSort,modulefilter:r}).subscribe(function(e){for(var t in n.moduleSearchresults=[],e)e.hasOwnProperty(t)&&n.moduleSearchresults.push({module:t,data:{hits:n.transformHits(e[t].hits),max_score:e[t].max_score,total:e[t].total}});n.moduleSearchresults.sort(function(e,t){return t.data.max_score-e.data.max_score}),n.lastSearchParams={modules:i,searchterm:s,size:o},n.runningmodulesearch=void 0,l.next(e),l.complete()}),l.asObservable()},e.prototype.loadMore=function(){var r=this,n=new rxjs_1.Subject;if(!(this.runningmodulesearch||this.moduleSearchresults[0].data.hits.length>=this.moduleSearchresults[0].data.total))return this.runningmodulesearch=this.backend.postRequest("search",{},{modules:0<this.lastSearchParams.modules.length?this.lastSearchParams.modules.join(","):"",searchterm:this.lastSearchParams.searchterm,aggregates:this.searchAggregates,sort:this.searchSort,records:this.lastSearchParams.size,start:this.moduleSearchresults[0].data.hits.length,modulefilter:this.modulefilter}).subscribe(function(e){for(var t=0,s=r.lastSearchParams.modules;t<s.length;t++)for(var i=0,o=e[s[t]].hits;i<o.length;i++){var a=o[i];r.moduleSearchresults[0].data.hits.push(r.tranformHit(a))}r.runningmodulesearch=void 0,n.next(e),n.complete()}),n.asObservable()},e.prototype.getSearchModules=function(){var o=this;this.backend.getRequest("fts/searchmodules").subscribe(function(e){for(var t=0,s=e.modules;t<s.length;t++){var i=s[t];o.metadata.checkModuleAcl(i,"list")&&o.searchModules.push(i)}})},e.prototype.resetData=function(){this.found=0,this.hits=[]},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[backend,http_1.HttpClient,configurationService,session,modelutilities,metadata])],e)}();exports.fts=fts,moment.defaultFormat="YYYY-MM-DD HH:mm:ss";var model=function(){function e(e,t,s,i,o,a,r,n,l,u,d){this.backend=e,this.broadcast=t,this.metadata=s,this.utils=i,this.session=o,this.recent=a,this.router=r,this.toast=n,this.language=l,this.modal=u,this.injector=d,this._module="",this.id="",this.acl={},this.data={acl:{edit:!0}},this.backupData={},this.data$=new core_1.EventEmitter,this.mode$=new core_1.EventEmitter,this.isValid=!1,this.isLoading=!1,this.isEditing=!1,this.isNew=!1,this._fields_stati=[],this._fields_stati_tmp=[],this._model_stati_tmp=[],this._messages=[],this.reference="",this._fields=[],this.messageChange$=new core_1.EventEmitter,this.duplicate=!1}return Object.defineProperty(e.prototype,"messages",{get:function(){return this._messages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"module",{get:function(){return this._module},set:function(e){this._module=e,this.initializeFieldsStati()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayname",{get:function(){return this.getFieldValue("summary_text")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fields",{get:function(){return!this.module||this._fields&&0!=this._fields.length||(this._fields=this.metadata.getModuleFields(this.module)),this._fields},enumerable:!0,configurable:!0}),e.prototype.generateGuid=function(){return this.utils.generateGuid()},e.prototype.isFieldRequired=function(e){switch(e){case"date_entered":case"date_modified":return!0;default:return this.metadata.getFieldRequired(this.module,e)}},e.prototype.isRequired=function(e){return this.isFieldRequired(e)},e.prototype.checkAccess=function(e){return!(!this.data||!this.data.acl)&&this.data.acl[e]},e.prototype.goDetail=function(){if(!this.checkAccess("detail"))return!1;this.router.navigate(["/module/"+this.module+"/"+this.id])},e.prototype.goToDetail=function(){this.goDetail()},e.prototype.goModule=function(){this.router.navigate(["/module/"+this.module])},e.prototype.goToModule=function(){this.goModule()},e.prototype.goToListView=function(){this.goModule()},e.prototype.getData=function(e,t,s,i){var o=this;void 0===e&&(e=!0),void 0===t&&(t=""),void 0===s&&(s=!0),void 0===i&&(i=!1);var a=new rxjs_1.Subject;return e&&this.resetData(),this.isLoading=s,this.backend.get(this.module,this.id,t).subscribe(function(e){o.data=e,o.data$.emit(e),o.broadcast.broadcastMessage("model.loaded",{id:o.id,module:o.module,data:o.data}),a.next(e),a.complete(),""!=t&&o.recent.trackItem(o.module,o.id,o.data.summary_text),o.initializeFieldsStati(),o.evaluateValidationRules(null,"init"),o.isLoading=!1},function(e){i&&(o.toast.sendToast("Error loading Record","error"),o.router.navigate(["/module/"+o.module]))}),a.asObservable()},e.prototype.validate=function(e){for(var t in this.resetMessages(),this.isValid=!0,this.fields)"id"===t||!this.getFieldStati(t).required||this.data[t]&&0!==this.data[t].length||(this.isValid=!1,this.addMessage("error",this.language.getLabel("MSG_INPUT_REQUIRED")+"!",t)),this.getFieldStati(t).invalid&&(this.isValid=!1);return this.isValid||console.warn("validation failed:",this.messages),this.isValid},e.prototype.initializeFieldsStati=function(){var e=[];for(var t in this.fields)e[t]=this.evaluateFieldStati(t);this._fields_stati=e},e.prototype.getDefaultStati=function(){return{editable:this.checkAccess("edit"),invalid:!1,required:!1,incomplete:!1,disabled:!1,hidden:!1,readonly:!1}},e.prototype.evaluateFieldStati=function(e){var t=this.getDefaultStati();return this.data&&this.data.acl_fieldcontrol&&this.data.acl_fieldcontrol[e]&&parseInt(this.data.acl_fieldcontrol[e],10)<3&&(t.editable=!1),this.isRequired(e)&&(t.required=!0),t},e.prototype.resetFieldStati=function(e){this._fields_stati[e]=this.evaluateFieldStati(e),this._fields_stati_tmp[e]=__assign({},this._fields_stati[e]),this.getFieldMessages(e,"error")&&(this._fields_stati_tmp[e].invalid=!0)},e.prototype.setFieldStatus=function(e,t,s){void 0===s&&(s=!0);try{var i=this._fields_stati[e];return i[t]&&!s?(console.warn("could not set status "+t+" to "+s+" because it has to be: "+i[t]),!1):(this._fields_stati_tmp[e]||(this._fields_stati_tmp[e]=__assign({},i)),this._fields_stati_tmp[e][t]=s,!0)}catch(e){return console.warn(e),!1}},e.prototype.setFieldStati=function(e,t){for(var s in t){if(!this.setFieldStatus(e,s,t[s]))return!1}return!0},e.prototype.getFieldStati=function(e){var t=this._fields_stati_tmp[e];return t||(t=this._fields_stati[e])||(t=this.getDefaultStati(),this._fields_stati[e]=t),!(t=__assign({},t)).invalid&&this.getFieldMessages(e,"error")&&(t.invalid=!0),t},e.prototype.evaluateValidationRules=function(e,t){var s=this.metadata.getModuleValidations(this.module);if(!s)return!0;this._fields_stati_tmp=[],this._model_stati_tmp=[],this.resetMessages();for(var i=0,o=s;i<o.length;i++){var a=o[i],r=0,n=!0;if(!(a.onevents instanceof Array)||a.onevents.includes(t)){if(a.conditions instanceof Array)for(var l=0,u=a.conditions;l<u.length;l++){var d=u[l];if(0<(r+=(1!=d.onchange||!e||d.fieldname==e)&&this.evaluateCondition(d)?1:0)&&"or"==a.logicoperator){n=!0;break}}if(a.conditions&&1<a.conditions.length&&"and"==a.logicoperator?r<a.conditions.length&&(n=!1):0==r&&a.conditions&&(n=!1),n)for(var c=0,h=a.actions;c<h.length;c++){var p=h[c];this.executeValidationAction(p)||console.warn("Action "+p.action+" for "+p.fieldname+" failed!")}}}},e.prototype.evaluateCondition=function(e){if(void 0===this.data[e.fieldname])return!1;var t=this.data[e.fieldname],s=this.evaluateValidationParams(e.valuations);return modelutilities.compare(t,e.comparator,s)},e.prototype.executeValidationAction=function(e){var t=this.evaluateValidationParams(e.params);switch(e.action){case"set_value":return this.data[e.fieldname]=t,!0;case"set_message":return t instanceof Object&&(this._messages.push(t),this.messageChange$.emit(!0),!0);case"error":return this.addMessage("error",t,e.fieldname);case"warning":return this.addMessage("warning",t,e.fieldname);case"notice":return this.addMessage("notice",t,e.fieldname);case"hide":return t="string"==typeof t?modelutilities.strtobool(t):t,this.setFieldStatus(e.fieldname,"hidden",t);case"show":return t=!("string"==typeof t?modelutilities.strtobool(t):t),this.setFieldStatus(e.fieldname,"hidden",t);case"require":return t="string"==typeof t?modelutilities.strtobool(t):t,this.setFieldStatus(e.fieldname,"required",t);case"set_stati":return t="string"==typeof t?JSON.parse(t):t,this.setFieldStati(e.fieldname,t);case"set_model_state":if(t instanceof Array)for(var s=0,i=t;s<i.length;s++){var o=i[s];this.checkModelState(o)||this._model_stati_tmp.push(o)}else this.checkModelState(t)||this._model_stati_tmp.push(t);return!0;default:return console.warn("action: "+e.action+" is not defined!"),!1}},e.prototype.evaluateValidationParams=function(e,t){if("string"==typeof e){if(/(\<[a-z\_]+\>)/.test(e))for(var s=0,i=e.match(/(\<[a-z\_]+\>)/g);s<i.length;s++){var o=i[s],a=o.replace("<","").replace(">",""),r=this.data[a]?this.data[a]:0;switch(this.metadata.getFieldDefs(this.module,a).type){case"datetimecombo":case"datetime":case"date":r&&(r=r.format("YYYY-MM-DD HH:mm:ss"))}e=e.replace(o,r)}if(/\d+[\.\-]\d+[\.\-]\d+/.test(e)&&/[\+\-]/.test(e))e=modelutilities.strtomoment(e)||e;else if(/\d+\s*[\+\-\*\/\^]\s*\d+/.test(e)){e=this.utils.compileMathExpression(e)||e}}return e},e.prototype.checkModelState=function(e){return this._model_stati_tmp.includes(e)},e.prototype.startEdit=function(){this.duplicate||(this.backupData=__assign({},this.data)),this.isEditing=!0,this.mode$.emit("edit")},e.prototype.getFieldValue=function(e){return this.data[e]},e.prototype.getField=function(e){return this.getFieldValue(e)},e.prototype.setFieldValue=function(e,t){if(!e)return!1;_.isString(t)&&(t=t.trim()),this.data[e]=t,this.data$.emit(this.data),this.evaluateValidationRules(e,"change")},e.prototype.setField=function(e,t){return this.setFieldValue(e,t)},e.prototype.setFields=function(e){for(var t in e){var s=e[t];_.isString(s)&&(s=s.trim()),this.data[t]=s}this.data$.emit(this.data),this.evaluateValidationRules(null,"change")},e.prototype.cancelEdit=function(){this.isEditing=!1,this.mode$.emit("display"),this.backupData&&(this.data=__assign({},this.backupData),this.data$.emit(this.data),this.backupData=null,this.resetMessages())},e.prototype.endEdit=function(){this.backupData=null,this.isEditing=!1,this.mode$.emit("display")},e.prototype.getDirtyFields=function(){var e={};for(var t in this.data)t&&(_.isArray(this.data[t])||!_.isEqual(this.data[t],this.backupData[t])||this.isFieldARelationLink(t))&&(e[t]=this.data[t]);return e},e.prototype.save=function(s){var i=this;void 0===s&&(s=!1);var o=new rxjs_1.Subject,e={};return this.isEditing?(e=this.getDirtyFields()).date_modified=this.data.date_modified:e=this.data,this.backend.save(this.module,this.id,e).subscribe(function(e){i.data=e,i.isNew=!1,i.data$.emit(e),i.broadcast.broadcastMessage("model.save",{id:i.id,reference:i.reference,module:i.module,data:i.data}),o.next(!0),o.complete(),s&&i.toast.sendToast(i.language.getLabel("LBL_DATA_SAVED")+".","success"),i.endEdit(),i.initializeFieldsStati()},function(t){switch(t.status){case 409:i.modal.openModal("ObjectOptimisticLockingModal",!1,i.injector).subscribe(function(e){e.instance.conflicts=t.error.error.conflicts});break;default:s&&i.toast.sendToast(i.language.getLabel("LBL_ERROR")+" "+t.status,"error",t.error.error.message),o.error(!0),o.complete()}}),o.asObservable()},e.prototype.delete=function(){var t=this,s=new rxjs_1.Subject;return this.backend.delete(this.module,this.id).subscribe(function(e){t.broadcast.broadcastMessage("model.delete",{id:t.id,module:t.module}),s.next(!0),s.complete()}),s.asObservable()},e.prototype.reset=function(){this.id=null,this.module=null,this._fields_stati_tmp=this._fields_stati=[],this.isLoading=!1,this.isEditing=!1,this.mode$.emit("display"),this.resetMessages(),this.resetData()},e.prototype.clone=function(){return{module:this.module,id:this.id,data:__assign({},this.data)}},e.prototype.getAuditLog=function(e){void 0===e&&(e={});var t=new rxjs_1.Subject;return this.backend.getAudit(this.module,this.id,e).subscribe(function(e){t.next(e),t.complete()},function(e){t.next(e),t.complete()}),t.asObservable()},e.prototype.resetData=function(){this.isValid=!0,this.data={}},e.prototype.initialize=function(e){return void 0===e&&(e=null),this.initializeModel(e)},e.prototype.initializeModel=function(e){void 0===e&&(e=null),this.id||(this.id=this.generateGuid()),this.data={},this.data.assigned_user_id=this.session.authData.userId,this.data.assigned_user_name=this.session.authData.userName,this.data.modified_by_id=this.session.authData.userId,this.data.modified_by_name=this.session.authData.userName,this.data.date_entered=new moment,this.data.date_modified=new moment,this.executeCopyRules(e),this.evaluateValidationRules(),this.data.acl={edit:!0},this.initializeFieldsStati(),this.evaluateValidationRules(null,"init")},e.prototype.addModel=function(e,t,s,i){var o=this;void 0===e&&(e=""),void 0===t&&(t=null),void 0===s&&(s={}),void 0===i&&(i=!1);var a=new rxjs_1.Subject;if(this.metadata.checkModuleAcl(this.module,"create")){for(var r in this.initializeModel(),this.executeCopyRules(t),this.reference=e,s)this.data[r]=s[r];this.modal.openModal("ObjectEditModal",!0,this.injector).subscribe(function(e){e&&(e.instance.model.isNew=!0,e.instance.reference=o.reference,e.instance.preventGoingToRecord=i,e.instance.action$.subscribe(function(e){a.next(e),a.complete()}))})}else this.toast.sendToast(this.language.getLabel("MSG_NOT_AUTHORIZED_TO_CREATE")+" "+this.language.getModuleName(this.module),"error"),window.setTimeout(function(){a.complete()},100);return a.asObservable()},e.prototype.executeCopyRules=function(e){void 0===e&&(e=null),this.executeCopyRulesGeneric(),e&&e.data&&this.executeCopyRulesParent(e)},e.prototype.executeCopyRulesGeneric=function(){for(var e=0,t=this.metadata.getCopyRules("*",this.module);e<t.length;e++){var s=t[e];s.tofield&&s.fixedvalue?this.setFieldValue(s.tofield,s.fixedvalue):s.tofield&&s.calculatedvalue&&this.setFieldValue(s.tofield,this.getCalculatdValue(s.calculatedvalue))}},e.prototype.executeCopyRulesParent=function(e){e.data.id||(e.data.id=e.id);for(var t=0,s=this.metadata.getCopyRules(e.module,this.module);t<s.length;t++){var i=s[t];i.fromfield&&i.tofield?this.setFieldValue(i.tofield,e.data[i.fromfield]):i.tofield&&i.fixedvalue&&this.setFieldValue(i.tofield,i.fixedvalue)}},e.prototype.getCalculatdValue=function(e){switch(e){case"now":return new moment;case"nextfullhour":var t=new moment;return 0==t.minute()||(t.minute(0),t.add(1,"h")),t}return""},e.prototype.edit=function(t,s){var i=this;if(void 0===t&&(t=!1),void 0===s&&(s=""),!this.checkAccess("edit"))return!1;this.modal.openModal("ObjectEditModal",!0,this.injector).subscribe(function(e){e&&(s&&""!=s&&(e.instance.componentSet=s),t?e.instance.model.getData(!1,"editview",!1).subscribe(function(e){i.startEdit()}):i.startEdit())})},e.prototype.duplicateCheck=function(e){void 0===e&&(e=!1);var t=new rxjs_1.Subject;if(e){var s=this.data;s.id=this.id,this.backend.checkDuplicates(this.module,s).subscribe(function(e){t.next(e),t.complete()})}else this.backend.getDuplicates(this.module,this.id).subscribe(function(e){t.next(e),t.complete()});return t.asObservable()},e.prototype.addMessage=function(e,t,s,i){return void 0===s&&(s=null),void 0===i&&(i="validation"),this._messages.push({type:e,message:t,reference:s,source:i}),"error"==e&&s&&this.setFieldStatus(s,"invalid",!0),this.messageChange$.emit(!0),!0},e.prototype.setFieldMessage=function(e,t,s,i){return this.resetFieldMessages(s,e,i),"error"==e&&this.setFieldStatus(s,"invalid",!0),this.addMessage(e,t,s,i)},e.prototype.getFieldMessages=function(t,s){var e=this._messages.filter(function(e){return e.reference==t&&(!s||e.type==s)});return 0<e.length&&e},e.prototype.resetFieldMessages=function(e,t,s){if(0==this._messages.length)return!0;for(var i=this._messages.length-1;0<=i;i--){var o=this._messages[i];o.reference!=e||t&&o.type!=t||s&&o.source!=s||(this._messages.splice(i,1),this.messageChange$.emit(!0))}return this.resetFieldStati(e),!0},e.prototype.resetMessages=function(e,t){if(void 0===t&&(t="validation"),0==this._messages.length)return!0;for(var s=this._messages.length-1;0<=s;s--){var i=this._messages[s];e&&i.type!=e||t&&i.source!=t||(this._messages.splice(s,1),this.messageChange$.emit(!0)),this.resetFieldStati(i.reference)}return!0},e.prototype.isFieldARelationLink=function(e){try{return"link"==this.fields[e].type}catch(e){return!1}},e.prototype.getRelatedRecords=function(e){var t=[];if(!this.isFieldARelationLink(e))return t;if(!this.data[e])return t;for(var s in this.data[e].beans)t.push(this.data[e].beans[s]);return t},e.prototype.setRelatedRecords=function(e,t){return void 0===t&&(t=null),!!this.isFieldARelationLink(e)&&(this.data[e]={beans:{}},t?this.addRelatedRecords(e,t):void 0)},e.prototype.addRelatedRecords=function(e,t,s){if(void 0===s&&(s=!0),!this.isFieldARelationLink(e))return!1;this.data[e]||(this.data[e]={beans:{}});for(var i=0,o=t;i<o.length;i++){var a=o[i];!s&&this.data[e].beans[a.id]||(this.data[e].beans[a.id]=a)}return!0},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[backend,broadcast,metadata,modelutilities,session,recent,router_1.Router,toast,language,modal,core_1.Injector])],e)}();exports.model=model;var mediafiles=function(){function e(e,t,s,i,o,a,r,n,l,u){this.sanitizer=e,this.http=t,this.backend=s,this.configurationService=i,this.session=o,this.metadata=a,this.footer=r,this.toast=n,this.language=l,this.modalservice=u,this.categoriesLoaded=!1,this.categories={},this.categoriesSorted=[]}return e.prototype.storeEtag=function(e,t){sessionStorage.mediaFileEtags||(sessionStorage.mediaFileEtags={})},e.prototype.getEtag=function(e){return sessionStorage.mediaFileEtags&&sessionStorage.mediaFileEtags[e]?sessionStorage.mediaFileEtags[e]:""},e.prototype._getImage=function(e,t){var s=this;void 0===t&&(t="");var i=new rxjs_1.Subject;return this.backend.getRawRequest("module/MediaFiles/"+e+"/file"+(""!=t?"/":"")+t,{},null,{}).subscribe(function(e){var t=URL.createObjectURL(e);i.next(s.sanitizer.bypassSecurityTrustUrl(t)),i.complete()}),i.asObservable()},e.prototype.getImageVariant=function(e,t){return this._getImage(e,t)},e.prototype.getImage=function(e){return this._getImage(e)},e.prototype.getImageThumb=function(e,t){return this._getImage(e,"th/"+t)},e.prototype.getImageSquare=function(e,t){return this._getImage(e,"sq/"+t)},e.prototype.uploadFile=function(e){if(0!==e.length){var s=new rxjs_1.Subject,t=new FormData;t.append("file",e[0],e[0].name);var i=new XMLHttpRequest;return i.onreadystatechange=function(e){if(void 0===e&&(e=this),4==i.readyState)try{var t=JSON.parse(i.response);s.next({filedata:t}),s.complete()}catch(e){({status:"error",data:"Unknown error occurred: ["+i.responseText+"]"})}},i.upload.addEventListener("progress",function(e){s.next({progress:{total:e.total,loaded:e.loaded}})},!1),i.open("POST",this.configurationService.getBackendUrl()+"/module/MediaFiles/fileupload",!0),i.setRequestHeader("OAuth-Token",this.session.authData.sessionId),i.send(t),s.asObservable()}},e.prototype.getMediaFile=function(e,t,s,i,o){var a=this;void 0===s&&(s=!1),void 0===i&&(i=!1);var r=new rxjs_1.Subject;return s?this.uploadMediaFile([],i,o).subscribe(function(e){e&&(r.next(e),r.complete())}):this.pickMediaFile(e,t).subscribe(function(e){e.id?(r.next(e.id),r.complete()):!0===e.upload&&a.uploadMediaFile([],i,o).subscribe(function(e){e&&(r.next(e),r.complete())})}),r.asObservable()},e.prototype.pickMediaFile=function(t,s){var i=new rxjs_1.Subject;return this.modalservice.openModal("MediaFilePicker").subscribe(function(e){e.instance.mediatype=t,e.instance.filetype=s,e.instance.answer.subscribe(function(e){i.next(e),i.complete()})}),i.asObservable()},e.prototype.uploadMediaFile=function(t,s,i){void 0===s&&(s=!1);var o=new rxjs_1.Subject;return this.modalservice.openModal("MediaFileUploader").subscribe(function(e){e.instance.acceptFileTypes=t,e.instance.noMetaData=s,e.instance.category=i,e.instance.answer.subscribe(function(e){o.next(e),o.complete()})}),o.asObservable()},e.prototype.makeFullName=function(e){return null===e.parent?e.fullName=e.name:e.fullName=this.makeFullName(e.parent)+" > "+e.name},e.prototype.setFullName=function(e){e.fullName||(e.fullName=this.makeFullName(e))},e.prototype.loadCategories=function(){var o=this,a=new rxjs_1.Subject;if(this.categoriesLoaded)return setTimeout(function(){a.next(),a.complete()},1),a;var e={fields:JSON.stringify(["id","name","parent_id"]),sortfield:"name",limit:-99};return this.backend.getRequest("/module/MediaCategories",e).subscribe(function(e){for(var t=0,s=e.list;t<s.length;t++){var i=s[t];o.categories[i.id]=i,o.categoriesSorted.push(i)}for(var i in o.categories)o.categories[i].parent=o.categories[i].parent_id&&""!=o.categories[i].parent_id?o.categories[o.categories[i].parent_id]:null;for(var i in o.categories)o.setFullName(o.categories[i]);o.categoriesSorted.sort(function(e,t){return e.fullName.localeCompare(t.fullName)}),o.categoriesLoaded=!0,a.next(),a.complete()},function(e){o.toast.sendToast(o.language.getLabel("ERR_NETWORK_LOADING"),"error","To retry: Close and reopen the window.",!1)}),a.asObservable()},e.prototype.fileIsInCategory=function(e,t){return!!(this.categoriesLoaded&&e&&""!=e&&t)&&(!!this.categories[e]&&(e===t.id||this.isChild(t,this.categories[e])))},e.prototype.isChild=function(e,t){return!!t.parent&&(e.id===t.parent_id||this.isChild(e,t.parent))},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[platform_browser_1.DomSanitizer,http_1.HttpClient,backend,configurationService,session,metadata,footer,toast,language,modal])],e)}();exports.mediafiles=mediafiles;var modelattachments=function(){function e(e,t,s,i,o,a){this.http=e,this.backend=t,this.configurationService=s,this.session=i,this.toast=o,this.language=a,this.module="",this.id="",this.items=[],this.count=0,this.files=[],this.loading=!1,this.serviceSubscriptions=[]}return e.prototype.getAttachments=function(){var o=this;this.resetData(),this.loading=!0,this.backend.getRequest("module/"+this.module+"/"+this.id+"/attachment/ui").subscribe(function(e){for(var t=0,s=e;t<s.length;t++){var i=s[t];i.date=new moment(i.date),o.files.push(i)}o.loading=!1},function(e){o.loading=!1})},e.prototype.humanFileSize=function(e){var t=e;if(Math.abs(e)<1024)return t+" B";for(var s=["kB","MB","GB","TB","PB","EB","ZB","YB"],i=-1;t/=1024,++i,1024<=Math.abs(t)&&i<s.length-1;);return t.toFixed(1)+" "+s[i]},e.prototype.uploadAttachments=function(e){var s=this;if(0!==e.length){var i=new rxjs_1.Subject,t=new FormData;t.append("file",e[0],e[0].name);var o=new XMLHttpRequest;return o.onreadystatechange=function(e){if(void 0===e&&(e=s),4==o.readyState)try{var t=JSON.parse(o.response);i.next({files:t}),i.complete()}catch(e){({status:"error",data:"Unknown error occurred: ["+o.responseText+"]"})}},o.upload.addEventListener("progress",function(e){i.next({progress:{total:e.total,loaded:e.loaded}})},!1),o.open("POST",this.configurationService.getBackendUrl()+"/module/"+this.module+"/"+this.id+"/attachment/ui",!0),o.setRequestHeader("OAuth-Token",this.session.authData.sessionId),o.send(t),i.asObservable()}},e.prototype.uploadAttachmentsBase64=function(e){var a=this;if(0!==e.length){for(var r=new rxjs_1.Subject,t=this.configurationService.getSystemParamater("upload_maxsize"),s=function(i){if(t&&i.size>t)return n.toast.sendToast(n.language.getLabelFormatted("LBL_EXCEEDS_MAX_UPLOADFILESIZE",[i.name,n.humanFileSize(t)]),"error"),"continue";var o={date:new moment,file:"",file_mime_type:i.type,filesize:i.size,filename:i.name,id:"",text:"",thumbnail:"",user_id:"1",user_name:"admin",uploadprogress:0};n.files.unshift(o),n.readFile(i).subscribe(function(e){var s=new XMLHttpRequest;s.onreadystatechange=function(e){if(void 0===e&&(e=a),4==s.readyState)try{var t=JSON.parse(s.response);o.id=t[0].id,o.thumbnail=t[0].thumbnail,o.user_id=t[0].user_id,o.user_name=t[0].user_name,delete o.uploadprogress,r.next({files:t}),r.complete()}catch(e){({status:"error",data:"Unknown error occurred: ["+s.responseText+"]"})}},s.upload.addEventListener("progress",function(e){o.uploadprogress=Math.round(e.loaded/e.total*100),r.next({progress:{total:e.total,loaded:e.loaded}})},!1),s.open("POST",a.configurationService.getBackendUrl()+"/module/"+a.module+"/"+a.id+"/attachment",!0),s.setRequestHeader("OAuth-Token",a.session.authData.sessionId),s.setRequestHeader("Content-Type","application/json;charset=UTF-8");var t={file:i.filecontent,filename:i.name,filemimetype:i.type};s.send(JSON.stringify(t))})},n=this,i=0,o=e;i<o.length;i++){s(o[i])}return r.asObservable()}},e.prototype.readFile=function(e){var i=new rxjs_1.Subject,o=new FileReader;return o.file=e,o.onloadend=function(e){var t=o.result.toString();t=t.substring(t.indexOf("base64,")+7);var s=o.file;s.filecontent=t,i.next(s),i.complete()},o.readAsDataURL(e),i.asObservable()},e.prototype.deleteAttachment=function(s){var i=this;this.backend.deleteRequest("module/"+this.module+"/"+this.id+"/attachment/"+s).subscribe(function(e){i.files.some(function(e,t){if(e.id==s)return i.files.splice(t,1),!0})})},e.prototype.downloadAttachment=function(e,t){var o=this;this.backend.getRequest("/module/"+this.module+"/"+this.id+"/attachment/"+e).subscribe(function(e){var t=o.b64toBlob(e.file,e.file_mime_type),s=URL.createObjectURL(t),i=document.createElement("a");i.href=s,i.download=e.filename,i.click(),i.remove()})},e.prototype.getAttachment=function(e){var t=new rxjs_1.Subject;return this.backend.getRequest("/module/"+this.module+"/"+this.id+"/attachment/"+e).subscribe(function(e){t.next(e.file),t.complete()}),t.asObservable()},e.prototype.b64toBlob=function(e,t,s){void 0===t&&(t=""),void 0===s&&(s=512);for(var i=atob(e),o=[],a=0;a<i.length;a+=s){for(var r=i.slice(a,a+s),n=new Array(r.length),l=0;l<r.length;l++)n[l]=r.charCodeAt(l);var u=new Uint8Array(n);o.push(u)}return new Blob(o,{type:t})},e.prototype.openAttachment=function(e,t){var i=this;this.backend.getRequest("/module/"+this.module+"/"+this.id+"/attachment/"+e).subscribe(function(e){var t=i.b64toBlob(e.file,e.file_mime_type),s=URL.createObjectURL(t);window.open(s,"_blank")})},e.prototype.resetData=function(){this.items=[]},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.HttpClient,backend,configurationService,session,toast,language])],e)}();exports.modelattachments=modelattachments;var modellist=function(){function e(e,t,s,i,o,a,r){var n=this;this.broadcast=e,this.backend=t,this.fts=s,this.metadata=i,this.language=o,this.userpreferences=a,this.session=r,this.module="",this.modulefilter="",this.listtype="all",this.listData={list:[],totalcount:0},this.listSelected={type:"",items:[]},this.lastFields=[],this.sortfield="",this.sortdirection="ASC",this.lastLoad=new moment,this.loadlimit=50,this.isLoading=!1,this.searchConditions=[],this.searchTerm="",this.searchAggregates=[],this.selectedAggregates=[],this.standardLists=[{id:"all",type:"all",name:"<LBL_ALL> <module>",basefilter:"all",config:{showSearch:!0,enableFilter:!1,enableAggregates:!0,enableDelete:!1}},{id:"owner",type:"owner",basefilter:"own",name:"<LBL_MY> <module>",config:{showSearch:!0,enableFilter:!1,enableAggregates:!0,enableDelete:!1}}],this.listTypes=[],this.currentList={},this.serviceSubscriptions=[],this.listtype$=new core_1.EventEmitter,this.serviceSubscriptions.push(this.broadcast.message$.subscribe(function(e){n.handleMessage(e)}))}return e.prototype.handleMessage=function(e){if(e.messagedata.module===this.module)switch(e.messagetype){case"model.delete":for(var t in this.listData.list)this.listData.list[t].id===e.messagedata.id&&(this.listData.list.splice(t,1),this.listData.totalcount--);break;case"model.save":var s=!1;for(var t in this.listData.list)this.listData.list[t].id===e.messagedata.id&&(this.listData.list[t]=e.messagedata.data,s=!0);s||this.reLoadList()}},e.prototype.ngOnDestroy=function(){for(var e=0,t=this.serviceSubscriptions;e<t.length;e++){t[e].unsubscribe()}},e.prototype.setModule=function(e){this.module=e,this.listTypes=[];for(var t=0,s=this.metadata.getModuleListTypes(this.module);t<s.length;t++){var i=s[t];this.addCustomListtype(i.id,i.name,i.basefilter,i.fielddefs,i.filterdefs,i.global)}var o=this.userpreferences.getPreference(e);o&&o.lastlisttype?this.setListType(o.lastlisttype):this.setListType("all",!1)},e.prototype.setSortField=function(e){this.sortfield==e?this.sortdirection="ASC"==this.sortdirection?"DESC":"ASC":(this.sortfield=e,this.sortdirection="ASC"),this.reLoadList()},e.prototype.addCustomListtype=function(e,t,s,i,o,a){this.listTypes.push({id:e,type:"custom",name:t,global:a,basefilter:s,fielddefs:i,filterdefs:o,config:{showSearch:!1,enableFilter:!0,enableDelete:!0}})},e.prototype.setListType=function(e,t){void 0===t&&(t=!0),this.listtype=e;for(var s=0,i=this.getListTypes();s<i.length;s++){var o=i[s];o.id===e&&(this.currentList=o)}if(t){var a=this.userpreferences.getPreference(this.module);a||(a={}),a.lastlisttype=e,this.userpreferences.setPreference(this.module,a)}this.listtype$.emit(e)},e.prototype.checkFilterChange=function(e){return e.basefilter!==this.currentList.basefilter||e.filterdefs!==this.currentList.filterdefs},e.prototype.canDelete=function(){try{return this.currentList.config.enableDelete}catch(e){return!1}},e.prototype.filterEnabled=function(){try{return this.currentList.config.enableFilter}catch(e){return!1}},e.prototype.aggregatesEnabled=function(){try{return this.currentList.config.enableAggregates}catch(e){return!1}},e.prototype.getListTypeName=function(e){void 0===e&&(e=""),e||(e=this.currentList.id);for(var t=0,s=this.getListTypes();t<s.length;t++){var i=s[t];if(i.id===e)return i.name}},e.prototype.getGlobal=function(){return this.currentList.global},e.prototype.getBaseFilter=function(){return this.currentList.basefilter},e.prototype.getFieldDefs=function(){try{return JSON.parse(atob(this.currentList.fielddefs))}catch(e){return[]}},e.prototype.getFilterDefs=function(){try{return JSON.parse(atob(this.currentList.filterdefs))}catch(e){return[]}},e.prototype.addListType=function(e,t){var s=this,i=new rxjs_1.Subject,o={list:e,global:t};return this.backend.addListType(this.module,o).subscribe(function(e){s.addCustomListtype(e.id,e.name,"all",null,null,e.global),s.metadata.addModuleListType(s.module,{id:e.id,type:"custom",name:e.name,basefilter:"all",fielddefs:null,filterdefs:null,config:{showSearch:!1,enableFilter:!0,enableDelete:!0}}),s.setListType(e.id),i.next(!0),i.complete()}),i.asObservable()},e.prototype.updateListType=function(s){var i=this,t=new rxjs_1.Subject;return this.backend.setListType(this.currentList.id,this.module,s).subscribe(function(e){i.listTypes.some(function(e){if(e.id==i.currentList.id){for(var t in s)s.hasOwnProperty(t)&&(e[t]=s[t]);return i.currentList=e,!0}}),s.id=i.currentList.id,i.metadata.updateModuleListType(i.module,s),i.listtype$.emit(i.currentList),t.next(!0),t.complete()}),t.asObservable()},e.prototype.deleteListType=function(s){var i=this;void 0===s&&(s="");var t=new rxjs_1.Subject;return""===s&&(s=this.currentList.id),this.backend.deleteListType(s).subscribe(function(e){i.setListType("all"),i.listTypes.some(function(e,t){if(e.id==s)return i.listTypes.splice(t,1),!0}),t.next(!0),t.complete()}),t.asObservable()},e.prototype.getLastLoadTime=function(){return this.lastLoad.format("HH:mm")},e.prototype.getListData=function(e){return this.resetListData(),e?this.lastFields=e:e=this.lastFields,this.sortfield||(this.sortfield=0<e.length?e[0]:"id"),this.loadList(e)},e.prototype.showSearch=function(e){e||(e=this.listtype);for(var t=0,s=this.getListTypes();t<s.length;t++){var i=s[t];if(i.id===e)return i.config.showSearch}return!1},e.prototype.loadFilteredList=function(e){var t=this;this.isLoading=!0;var s=new rxjs_1.Subject;return this.resetListData(),this.backend.getList(this.module,this.sortfield,this.sortdirection,e,{start:0,limit:this.loadlimit,listid:this.currentList.id,searchterm:this.searchTerm,searchfields:{join:"AND",conditions:this.searchConditions}}).subscribe(function(e){t.listData=e,t.lastLoad=new moment,t.isLoading=!1,s.next(!0),s.complete()}),s.asObservable()},e.prototype.loadMoreList=function(){var a=this;if(this.isLoading||this.listData.list.length>=this.listData.totalcount)return!1;this.isLoading=!0,"all"==this.currentList.type?this.fts.loadMore().subscribe(function(e){for(var t=[],s=0,i=e[a.module].hits;s<i.length;s++){var o=i[s];o._source.acl=o.acl,t.push(o._source)}a.listData.list=a.listData.list.concat(t),a.lastLoad=new moment,a.isLoading=!1}):this.backend.getList(this.module,this.sortfield,this.sortdirection,this.lastFields,{start:this.listData.list.length,limit:this.loadlimit,listid:this.currentList.id}).subscribe(function(e){a.listData.list=a.listData.list.concat(e.list),a.lastLoad=new moment,a.isLoading=!1})},e.prototype.loadMoreFilteredList=function(){var t=this;if(this.isLoading||this.listData.list.length>=this.listData.totalcount)return!1;this.isLoading=!0;var s=new rxjs_1.Subject;return this.backend.all(this.module,{offset:this.listData.list.length,limit:this.loadlimit,listid:this.currentList.id,sortfield:this.sortfield,sortdirection:this.sortdirection,searchterm:this.searchTerm,searchfields:{join:"AND",conditions:this.searchConditions}}).subscribe(function(e){t.listData.list=t.listData.list.concat(e),t.lastLoad=new moment,t.isLoading=!1,s.next(!0),s.complete()}),s},e.prototype.reLoadList=function(){return this.loadList(this.lastFields)},e.prototype.resetListData=function(){this.listData={list:[],totalcount:0}},e.prototype.getListTypes=function(e){void 0===e&&(e=!0);var t=[];if(e)for(var s=0,i=this.standardLists;s<i.length;s++){var o=i[s];t.push({id:o.id,type:o.type,global:1,name:o.name.replace("<module>",this.language.getModuleName(this.module)).replace("<LBL_MY>",this.language.getLabel("LBL_MY")).replace("<LBL_ALL>",this.language.getLabel("LBL_ALL")),basefilter:o.basefilter,config:o.config})}for(var a=0,r=this.listTypes;a<r.length;a++){o=r[a];t.push(o)}return t},e.prototype.hasAggregates=function(){return 0<this.selectedAggregates.length},e.prototype.setAggregate=function(e,t){this.selectedAggregates.push(e+"::"+t),this.reLoadList()},e.prototype.checkAggregate=function(e,t){return-1<this.selectedAggregates.indexOf(e+"::"+t.trim())},e.prototype.removeAggregate=function(e,t){var s=this.selectedAggregates.indexOf(e+"::"+t);0<=s&&(this.selectedAggregates.splice(s,1),this.reLoadList())},e.prototype.removeAllAggregates=function(){this.selectedAggregates=[],this.reLoadList()},e.prototype.setAllSelected=function(){this.listSelected.type="all";for(var e=0,t=this.listData.list;e<t.length;e++){t[e].selected=!0}},e.prototype.setAllUnselected=function(){this.listSelected.type="none";for(var e=0,t=this.listData.list;e<t.length;e++){t[e].selected=!1}},e.prototype.getSelectedCount=function(){for(var e=0,t=0,s=this.listData.list;t<s.length;t++){s[t].selected&&e++}return e},e.prototype.getSelectedItems=function(){for(var e=[],t=0,s=this.listData.list;t<s.length;t++){var i=s[t];i.selected&&e.push(i)}return e},e.prototype.checkAccess=function(e){if(!this.currentList.global)return!0;switch(e){case"delete":return this.canDelete()&&this.session.authData.admin;case"edit":return this.session.authData.admin;default:return!1}},e.prototype.loadList=function(e){var a=this;this.isLoading=!0;var r=new rxjs_1.Subject;if(this.resetListData(),"all"==this.currentList.type||"owner"==this.currentList.type){var t={};t[this.module]=this.selectedAggregates,this.fts.searchByModules(this.searchTerm,[this.module],this.loadlimit,t,{sortfield:this.sortfield,sortdirection:this.sortdirection.toLowerCase()},"owner"==this.currentList.type,this.modulefilter).subscribe(function(e){for(var t={list:[],totalcount:e[a.module].total},s=0,i=e[a.module].hits;s<i.length;s++){var o=i[s];o._source.acl=o.acl,o._source.acl_fieldcontrol=o.acl_fieldcontrol,t.list.push(o._source)}a.listData=t,a.searchAggregates=e[a.module].aggregations,a.lastLoad=new moment,a.isLoading=!1,r.next(!0),r.complete()})}else this.backend.getList(this.module,this.sortfield,this.sortdirection,e,{start:0,limit:this.loadlimit,listid:this.currentList.id,modulefilter:this.modulefilter}).subscribe(function(e){a.listData=e,a.lastLoad=new moment,a.isLoading=!1,r.next(!0),r.complete()});return r.asObservable()},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[broadcast,backend,fts,metadata,language,userpreferences,session])],e)}();exports.modellist=modellist;var navigation=function(){function e(e,t,s){var i=this;this.title=e,this.broadcast=t,this.configurationService=s,this.activeModule="Home",this.activeId="",this.activeModule$=new core_1.EventEmitter,this.broadcast.message$.subscribe(function(e){return i.handleMessage(e)})}return e.prototype.setActiveModule=function(e,t,s){void 0===t&&(t=""),void 0===s&&(s=""),this.activeModule=e,this.activeId=t,this.activeModule$.emit(e),this.title.setTitle(this.systemName+" "+(""!==s?s:e))},Object.defineProperty(e.prototype,"systemName",{get:function(){return this.configurationService.data.display?this.configurationService.data.display:"SpiceCRM"},enumerable:!0,configurable:!0}),e.prototype.handleMessage=function(e){switch(e.messagetype){case"model.save":this.activeModule===e.messagedata.module&&this.activeId===e.messagedata.id&&this.title.setTitle(this.systemName+" "+e.messagedata.data.summary_text)}},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[platform_browser_1.Title,broadcast,configurationService])],e)}();exports.navigation=navigation;var popup=function(){function e(){this.closePopup$=new core_1.EventEmitter}return e.prototype.close=function(){this.closePopup$.emit(!0)},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[])],e)}();exports.popup=popup;var view=function(){function e(){this.mode="view",this.mode$=new core_1.EventEmitter,this.isEditable=!1,this.displayLinks=!0,this.editfieldid="",this.labels="default",this.size="regular"}return e.prototype.isEditMode=function(){return"edit"===this.mode},e.prototype.setEditMode=function(e){void 0===e&&(e=""),this.mode="edit",this.editfieldid=e,this.mode$.emit(this.mode)},e.prototype.setViewMode=function(){this.mode="view",this.mode$.emit(this.mode)},e=__decorate([core_1.Injectable()],e)}();exports.view=view;var relatedmodels=function(){function e(e,t,s,i){var o=this;this.metadata=e,this.backend=t,this.broadcast=s,this.modelutilities=i,this.module="",this.relatedModule="",this.linkName="",this.modulefilter="",this.id="",this.items=[],this.items$=new core_1.EventEmitter,this.count=0,this.loaditems=5,this.relationshipFields=[],this.isloading=!0,this.sort={sortfield:"",sortdirection:"ASC"},this.lastLoad=new moment,this.serviceSubscriptions=[],this.serviceSubscriptions.push(this.broadcast.message$.subscribe(function(e){o.handleMessage(e)}))}return e.prototype.stopSubscriptions=function(){for(var e=0,t=this.serviceSubscriptions;e<t.length;e++){t[e].unsubscribe()}},Object.defineProperty(e.prototype,"sortfield",{get:function(){return this.sort.sortfield},set:function(e){this.sort.sortfield==e?this.sort.sortdirection="ASC"==this.sort.sortdirection?"DESC":"ASC":(this.sort.sortfield=e,this.sort.sortdirection="ASC"),this.getData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_linkName",{get:function(){return""!=this.linkName?this.linkName:this.relatedModule.toLowerCase()},enumerable:!0,configurable:!0}),e.prototype.handleMessage=function(e){if(-1!==e.messagetype.indexOf("model")&&e.messagedata.module===this.relatedModule)switch(e.messagetype){case"model.delete":for(var t in this.items)this.items[t].id===e.messagedata.id&&(this.items.splice(t,1),this.count--,this.items$.emit(this.items));break;case"model.save":this.getData();for(var s=!1,i=0,o=this.items;i<o.length;i++){var a=o[i];if(a.id===e.messagedata.id){for(var r in a)a.hasOwnProperty(r)&&e.messagedata.data.hasOwnProperty(r)&&(a[r]=e.messagedata.data[r]);s=!0}}s?this.sortItems():this.getData()}},e.prototype.getLastLoadTime=function(){return this.lastLoad.format("HH:mm")},e.prototype.getData=function(){var s=this;if(!1===this.metadata.checkModuleAcl(this.relatedModule,"list"))return!1;this.resetData();var e={getcount:this.isloading=!0,offset:0,limit:this.loaditems,modulefilter:this.modulefilter,relationshipFields:JSON.stringify(this.relationshipFields),sort:this.sort.sortfield?JSON.stringify(this.sort):""};this.backend.getRequest("module/"+this.module+"/"+this.id+"/related/"+this._linkName,e).subscribe(function(e){for(var t in s.items=[],s.count=parseInt(e.count,10),e.list)e.list.hasOwnProperty(t)&&(e.list[t].relid=t,e.list[t]=s.modelutilities.backendModel2spice(s.relatedModule,e.list[t]),s.items.push(e.list[t]));s.isloading=!1,s.sortItems(),s.lastLoad=new moment,s.items$.emit(s.items)})},e.prototype.sortItems=function(){var i=this;this.sort.sortfield&&this.items.sort(function(e,t){var s=0;return s=isNaN(parseInt(e[i.sort.sortfield],10))||isNaN(parseInt(t[i.sort.sortfield],10))?e[i.sort.sortfield]>t[i.sort.sortfield]?1:-1:parseInt(e[i.sort.sortfield],10)>parseInt(t[i.sort.sortfield],10)?1:-1,"ASC"==i.sort.sortdirection?s:-1*s})},e.prototype.resetData=function(){this.items=[]},e.prototype.addItems=function(o){for(var a=this,e=[],t=0,s=o;t<s.length;t++){var i=s[t];e.push(i.id)}this.backend.postRequest("module/"+this.module+"/"+this.id+"/related/"+this._linkName,[],e).subscribe(function(e){for(var t=function(t){var s=!1;a.items.some(function(e){if(e.id==t.id)return s=!0}),s||(a.items.push(t),a.count++)},s=0,i=o;s<i.length;s++){t(i[s])}a.items$.emit(a.items)})},e.prototype.setItem=function(e){this.backend.putRequest("module/"+this.module+"/"+this.id+"/related/"+this._linkName,[],this.modelutilities.spiceModel2backend(this.relatedModule,e)).subscribe(function(e){})},e.prototype.deleteItem=function(s){var i=this,e=[];e.push(s);var t={relatedids:e};this.backend.deleteRequest("module/"+this.module+"/"+this.id+"/related/"+this._linkName,t).subscribe(function(e){i.items.some(function(e,t){if(e.id==s)return i.items.splice(t,1),i.count--,i.items$.emit(i.items),!0})})},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[metadata,backend,broadcast,modelutilities])],e)}();exports.relatedmodels=relatedmodels;var activitiyTimeLineService=function(){function e(e,t,s,i,o){var a=this;this.backend=e,this.modelutilities=t,this.configurationService=s,this.session=i,this.broadcast=o,this.serviceSubscriptions=[],this.filters={objectfilters:[],own:""},this.defaultLimit=5,this.modules=["Activities","History"],this.timelineModules=["Calls","Meetings","Tasks","Emails","Notes"],this.activeStates=["Planned","In Progress","Not Started","Pending Input"],this.sortDates={Calls:"date_start",Meetings:"date_start",Tasks:"date_due",Emails:"date_entered",Notes:"date_entered"},this.activities={Activities:{loading:!1,list:[],totalcount:0},History:{loading:!1,list:[],totalcount:0}},this.serviceSubscriptions.push(this.broadcast.message$.subscribe(function(e){return a.handleMessage(e)}))}return e.prototype.stopSubscriptions=function(){for(var e=0,t=this.serviceSubscriptions;e<t.length;e++){t[e].unsubscribe()}},e.prototype.handleMessage=function(s){var i=this,e=s.messagetype.split(".");if("model"===e[0])switch(e[1]){case"save":var o="History";if(s.messagedata.data.status&&0<=this.activeStates.indexOf(s.messagedata.data.status)?o="Activities":this.activities.Activities.list.some(function(e,t){if(e.id==s.messagedata.id)return i.activities.Activities.list.splice(t,1),!0}),(s.messagedata.data.parent_id===this.parent.id||s.messagedata.data.contact_id===this.parent.id)&&0<=this.timelineModules.indexOf(s.messagedata.module)){var a=!1;this.activities[o].list.some(function(e,t){if(e.id==s.messagedata.id)return a=!0,i.activities[o].list[t].data=s.messagedata.data,!0}),a||(this.activities[o].list.push({module:s.messagedata.module,id:s.messagedata.id,data:s.messagedata.data}),this.activities[o].totalcount++),this.sortListdata(o)}break;case"delete":var r=!1;if(0<=this.timelineModules.indexOf(s.messagedata.module)){if(this.activities.Activities.list.some(function(e,t){if(e.module,s.messagedata.module,e.id===s.messagedata.id)return i.activities.Activities.list.splice(t,1),r=!0}),r)return;this.activities.History.list&&this.activities.History.list.some(function(e,t){if(e.module,s.messagedata.module,e.id===s.messagedata.id)return i.activities.History.list.splice(t,1),r=!0})}}},e.prototype.reload=function(){for(var e=0,t=this.modules;e<t.length;e++){var s=t[e];this.getTimeLineData(s)}},e.prototype.getTimeLineData=function(o){var a=this;this.resetListData(o);var e={count:this.activities[o].loading=!0,limit:this.defaultLimit,objects:JSON.stringify(this.filters.objectfilters),own:this.filters.own};this.backend.getRequest("module/"+o+"/"+this.parent.module+"/"+this.parent.id,e).subscribe(function(e){if(e){for(var t=0,s=e.items;t<s.length;t++){var i=s[t];i.data=a.modelutilities.backendModel2spice(i.module,i.data)}a.activities[o].list=e.items,a.activities[o].list.totalcount=parseInt(e.count)}a.activities[o].loading=!1})},e.prototype.getMoreTimeLineData=function(o,e){var a=this;if(void 0===e&&(e=5),this.canLoadMore(o)&&!this.activities[o].loading){var t={start:this.activities[o].list.length,limit:e,objects:JSON.stringify(this.filters.objectfilters),own:this.filters.own};this.activities[o].loading=!0,this.backend.getRequest("module/"+o+"/"+this.parent.module+"/"+this.parent.id,t).subscribe(function(e){for(var t=0,s=e.items;t<s.length;t++){var i=s[t];i.data=a.modelutilities.backendModel2spice(i.module,i.data),a.activities[o].list.push(i)}a.activities[o].loading=!1})}},e.prototype.resetListData=function(e){this.activities[e]={loading:!1,list:[],totalcount:0}},e.prototype.canLoadMore=function(e){return this.activities[e].list.totalcount>this.activities[e].list.length},e.prototype.sortListdata=function(o){var a=this;this.activities[o].list.sort(function(e,t){var s=new moment(e.data[a.sortDates[e.module]]),i=new moment(t.data[a.sortDates[t.module]]);return"Activities"!==o?s.isBefore(i):s.isAfter(i)})},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[backend,modelutilities,configurationService,session,broadcast])],e)}();exports.activitiyTimeLineService=activitiyTimeLineService;var fielderrorgrouping=function(){function e(){this.fieldsWithErrors={},this.nrErrorsFields=0,this.change$=new core_1.EventEmitter}return e.prototype.setError=function(e,t){var s=!1;t?this.fieldsWithErrors[e]||(this.fieldsWithErrors[e]=!0,this.nrErrorsFields++,s=!0):this.fieldsWithErrors[e]&&(delete this.fieldsWithErrors[e],this.nrErrorsFields--,s=!0),s&&this.change$.emit(this.nrErrorsFields)},e.prototype.hasErrors=function(){return this.nrErrorsFields||!1},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[])],e)}();exports.fielderrorgrouping=fielderrorgrouping;